<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Implementation Profile for using OASIS DSS in Central Signing Services</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/eln-portrait.css" media="print" >
    <link type="text/css" rel="stylesheet" href="assets/css/eln-custom.css" media="print" >
  </head>
  <body>
    <article class="markdown-body"><p>
<img align="left" src="img/sweden-connect.png"></img>
<img align="right" src="img/digg_centered.png"></img>
</p>
<p>
<img align="center" src="img/transparent.png"></img>
</p>

<h1 id="implementation-profile-for-using-oasis-dss-in-central-signing-services">Implementation Profile for using OASIS DSS in Central Signing Services</h1>
<h3 id="version-16---2024-11-26---draft-version">Version 1.6 - 2024-11-26 - <em>Draft version</em></h3>
<p>Registration number: <strong>2019-312</strong></p>
<hr>
<p class="copyright-statement">
Copyright &copy; <a href="https://www.digg.se">The Swedish Agency for Digital Government (Digg)</a>, 2015-2024. All Rights Reserved.
</p>

<h2 id="table-of-contents">Table of Contents</h2>
<ol class="list">
<li><p><a href="#introduction"><strong>Introduction</strong></a></p>
<p> 1.1. <a href="#terminology">Terminology</a></p>
<p> 1.2. <a href="#requirement-key-words">Requirement key words</a></p>
<p> 1.3. <a href="#namespace-references">Namespace references</a></p>
<p> 1.4. <a href="#identification">Identification</a></p>
<p> 1.5. <a href="#structure">Structure</a></p>
</li>
<li><p><a href="#sign-request-and-response-messages"><strong>Sign request and response messages</strong></a></p>
<p> 2.1. <a href="#sign-requests">Sign Requests</a></p>
<p> 2.1.1. <a href="#signature-on-sign-requests">Signature on Sign Requests</a></p>
<p> 2.1.2. <a href="#data-to-be-signed">Data To Be Signed</a></p>
<p> 2.1.3. <a href="#dss-extension">DSS Extension</a></p>
<p> 2.1.3.1. <a href="#version">Version</a></p>
<p> 2.1.3.2. <a href="#conditions">Conditions</a></p>
<p> 2.1.3.3. <a href="#signer">Signer</a></p>
<p> 2.1.3.4. <a href="#identityprovider">IdentityProvider</a></p>
<p> 2.1.3.5. <a href="#signrequester">SignRequester</a></p>
<p> 2.1.3.6 <a href="#signservice">SignService</a></p>
<p> 2.1.3.7. <a href="#requestedsignaturealgorithm">RequestedSignatureAlgorithm</a></p>
<p> 2.1.3.8. <a href="#signmessage">SignMessage</a></p>
<p> 2.1.3.8.1. <a href="#signmessage-element">SignMessage Element</a></p>
<p> 2.1.3.8.2. <a href="#requesting-identity-provider-to-display-signmessage">Requesting Identity Provider to Display SignMessage</a></p>
<p> 2.1.3.9. <a href="#certrequestproperties">CertRequestProperties</a></p>
<p> 2.1.3.9.1. <a href="#authncontextclassref">AuthnContextClassRef</a></p>
<p> 2.1.3.9.2. <a href="#requestedcertattributes">RequestedCertAttributes</a></p>
<p> 2.2. <a href="#sign-responses">Sign Responses</a></p>
<p> 2.2.1. <a href="#signature-on-sign-responses">Signature on Sign Responses</a></p>
<p> 2.2.2. <a href="#sign-response-status-information">Sign Response Status Information</a></p>
<p> 2.2.3. <a href="#generated-signature">Generated Signature</a></p>
<p> 2.2.4. <a href="#dss-extension">DSS Extension</a></p>
<p> 2.2.4.1. <a href="#version2">Version</a></p>
<p> 2.2.4.2. <a href="#responsetime">ResponseTime</a></p>
<p> 2.2.4.3. <a href="#request">Request</a></p>
<p> 2.2.4.4. <a href="#signerassertioninfo">SignerAssertionInfo</a></p>
<p> 2.2.4.5. <a href="#signaturecertificatechain">SignatureCertificateChain</a></p>
</li>
<li><p><a href="#http-post-binding"><strong>HTTP POST Binding</strong></a></p>
<p> 3.1. <a href="#message-exchange-model">Message Exchange Model</a></p>
<p> 3.1.1. <a href="#sign-request-xhtml-form">Sign Request XHTML Form</a></p>
<p> 3.1.2. <a href="#sign-response-xhtml-form">Sign Response XHTML Form</a></p>
</li>
<li><p><a href="#references"><strong>References</strong></a></p>
<p> 4.1. <a href="#normative-references">Normative References</a></p>
<p> 4.2. <a href="#informative-references">Informative References</a></p>
</li>
<li><p><a href="#changes-between-versions"><strong>Changes between versions</strong></a></p>
</li>
</ol>
<p><a name="introduction"></a></p>
<h2 id="1-introduction">1. Introduction</h2>
<p>This document specifies an implementation profile for exchange of sign
requests and responses using the OASIS DSS protocol [<a href="#dss">DSS</a>], enhanced by
the DSS Extensions for Federated Central Signing Services [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>Section 2 defines the sign request and response messages and section 3
defines the transport of these messages using HTTP POST.</p>
<p><a name="terminology"></a></p>
<h3 id="11-terminology">1.1. Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Defined meaning</th>
</tr>
</thead>
<tbody><tr>
<td><strong>User</strong></td>
<td>The entity requested to sign a document.</td>
</tr>
<tr>
<td><strong>Requesting Service</strong></td>
<td>The service requesting the signature on a particular document by a particular user.</td>
</tr>
<tr>
<td><strong>Signing Service</strong></td>
<td>A centralized service that manages the process to authenticate the user that has been requested to sign a document, and the process to obtain the user’s signature on the requested document.</td>
</tr>
</tbody></table>
<p><a name="requirement-key-words"></a></p>
<h3 id="12-requirement-key-words">1.2. Requirement key words</h3>
<p>The key words <strong>MUST</strong>, <strong>MUST</strong> <strong>NOT</strong>, <strong>REQUIRED</strong>, <strong>SHALL</strong>,
<strong>SHALL</strong> <strong>NOT</strong>, <strong>SHOULD</strong>, <strong>SHOULD</strong> <strong>NOT</strong>, <strong>RECOMMENDED</strong>,
<strong>MAY</strong>, and <strong>OPTIONAL</strong> are to be interpreted as described in
[<a href="#rfc2119">RFC2119</a>].</p>
<p>These keywords are capitalized when used to unambiguously specify
requirements over protocol features and behavior that affect the
interoperability and security of implementations. When these words are
not capitalized, they are meant in their natural-language sense.</p>
<p><a name="namespace-references"></a></p>
<h3 id="13-namespace-references">1.3. Namespace references</h3>
<p>Conventional XML namespace prefixes are used throughout the listings in
this specification to stand for their respective namespaces as follows,
whether or not a namespace declaration is present in the example:</p>
<table>
<thead>
<tr>
<th>Prefix</th>
<th>XML Namespace</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td>csig</td>
<td><code>http://id.elegnamnden.se/csig/1.1/dss-ext/ns</code></td>
<td>For the DSS extension namespace [<a href="#dss-ext">DSS-Ext</a>] (default namespace).</td>
</tr>
<tr>
<td>dss</td>
<td><code>urn:oasis:names:tc:dss:1.0:core:schema</code></td>
<td>The DSS core namespace [<a href="#dss">DSS</a>].</td>
</tr>
<tr>
<td>ds</td>
<td><code>http://www.w3.org/2000/09/xmldsig\#</code></td>
<td>The XML Signature Syntax and Processing specification [<a href="#xmlsig">XMLSig</a>] and its governing schema [<a href="#xmlsig-xsd">XMLSig-XSD</a>].</td>
</tr>
<tr>
<td>saml</td>
<td><code>urn:oasis:names:tc:SAML:2.0:assertion</code></td>
<td>The SAML V2.0 assertion namespace, defined in the schema [<a href="#saml-xsd">SAML-XSD</a>].</td>
</tr>
</tbody></table>
<hr>
<p><a name="identification"></a></p>
<h3 id="14-identification">1.4. Identification</h3>
<p>The following URI identifier identifies this profile:</p>
<blockquote>
<p><strong><code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code></strong></p>
</blockquote>
<p><a name="structure"></a></p>
<h3 id="15-structure">1.5. Structure</h3>
<p>This specification uses the following typographical conventions in text:
<code>&lt;EidElement&gt;</code>, <code>&lt;ns:ForeignElement&gt;</code>, <code>Attribute</code>, <strong>Datatype</strong>,
<code>OtherCode</code>.</p>
<p><a name="sign-request-and-response-messages"></a></p>
<h2 id="2-sign-request-and-response-messages">2. Sign Request and Response Messages</h2>
<p>This section defines a profile for sign requests and responses using the
OASIS DSS standard [<a href="#dss">DSS</a>] in combination with “DSS extensions for
Federated Central Signing Services” [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>In the following sections the OASIS DSS standard is referred to as “DSS”
and the DSS extensions are referred to as “DSS-Ext”.</p>
<p>Conformance with this implementation profile requires full conformance
with DSS and DSS-Ext. In case of conflict between DSS-Ext and DSS,
DSS-Ext is the normative one. In case of differences between this
implementation profile and DSS-Ext, this implementation profile is the
normative one.</p>
<p><a name="sign-requests"></a></p>
<h3 id="21-sign-requests">2.1. Sign Requests</h3>
<p>Sign requests are carried in a <code>&lt;dss:SignRequest&gt;</code> element according to requirements and conditions of the following subsections.</p>
<p>The <code>&lt;dss:SignRequest&gt;</code> element MUST have a <code>Profile</code> attribute with the value <code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>, which specifies conformance to this implementation profile.</p>
<p>The <code>&lt;dss:SignRequest&gt;</code> element MUST have a <code>RequestID</code> attribute with a value that uniquely identifies this request. The <code>RequestID</code> value MUST be a random generated value with at least 128 bit entropy and a length of at least 20 bytes.</p>
<p><a name="signature-on-sign-requests"></a></p>
<h4 id="211-signature-on-sign-requests">2.1.1. Signature on Sign Requests</h4>
<p>Sign requests MUST be signed. The signature MUST have a Same-Document URI-Reference (URI=””) to ensure that the signature covers the complete <code>&lt;dss:SignRequest&gt;</code> element.</p>
<p>The resulting <code>&lt;ds:Signature&gt;</code> element MUST be placed inside the <code>&lt;dss:OptionalInputs&gt;</code> element in accordance with section 5 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>The Signature Service MUST NOT process the sign request unless the signature of the sign request can be authenticated as originating from a legitimate Requesting Service.</p>
<p><a name="data-to-be-signed"></a></p>
<h4 id="212-data-to-be-signed">2.1.2. Data To Be Signed</h4>
<p>A representation of the document to be signed MUST be provided in accordance with section 4.1 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>Data to be signed MUST be provided in a <code>&lt;SignTaskData&gt;</code> element.</p>
<p>The <code>&lt;SignTasks&gt;</code> element MAY contain one or more <code>&lt;SignTaskData&gt;</code> elements, representing one or more requested signatures.</p>
<p><a name="dss-extension"></a></p>
<h4 id="213-dss-extension">2.1.3. DSS Extension</h4>
<p>The <code>&lt;dss:OptionalInput&gt;</code> element of the sign request MUST contain a
<code>&lt;SignRequestExtension&gt;</code> element according to requirements and
conditions of the following subsections.</p>
<p><a name="version"></a></p>
<h5 id="2131-version">2.1.3.1. Version</h5>
<p>The <code>Version</code> attribute giving the version number of the [<a href="#dss-ext">DSS-Ext</a>] specification
SHOULD be set to the version number that is supported by the sender.
If absent, the default value &quot;1.1&quot; MUST be assumed.</p>
<p><a name="conditions"></a></p>
<h5 id="2132-conditions">2.1.3.2. Conditions</h5>
<p>A <code>&lt;saml:Conditions&gt;</code> element MUST be present. This element MUST NOT
contain any information in addition to what is defined in section 3.1 of
[<a href="#dss-ext">DSS-Ext</a>].</p>
<p>If the <code>&lt;saml:Conditions&gt;</code> element contains the <code>NotBefore</code> and/or <code>NotOnOrAfter</code> attributes, the Signature Service consuming these values MAY consider them in its processing. However, a Signature Service MUST have a limitation on the maximum age of received messages, and if <code>NotOnOrAfter</code> exceeds this limitation, the <code>NotOnOrAfter</code> value MUST be ignored.</p>
<p>This specification does not state how long the message age limitation should be. However, it is RECOMMENDED that it does not exceed 3 minutes. </p>
<p><a name="signer"></a></p>
<h5 id="2133-signer">2.1.3.3. Signer</h5>
<p>The Requesting Service MAY include a <code>&lt;Signer&gt;</code> element containing the SAML attributes that 
are necessary in order to uniquely identify the signer. The present attributes MUST match the attributes
that are provided for this signer when authenticating the signer using the Identity Provider specified in the <code>&lt;IdentityProvider&gt;</code> element.</p>
<p>It is RECOMMENDED that a Signature Requester that has authenticated the user before sending a 
signature request includes relevant SAML attributes in the <code>&lt;Signer&gt;</code> element. If this is not done, 
the identity of the signer needs to be verified after the signature process has completed in order to ensure
that the authenticated user was the signer.</p>
<p>The Signing Service MUST match all attribute values provided in the
<code>&lt;Signer&gt;</code> element with SAML attributes provided for this signer
subject in a valid assertion obtained from the specified Identity
Provider.</p>
<p>If any of the attributes specified in the <code>&lt;Signer&gt;</code> element cannot
be found or matched with a corresponding attribute value from an
obtained assertion from the specified Identity Provider, the Signing
Service MUST reject the sign request.  </p>
<p><a name="identityprovider"></a></p>
<h5 id="2134-identityprovider">2.1.3.4. IdentityProvider</h5>
<p>This element MUST be present, specifying the SAML entityID of the
Identity Provider that MUST be used to authenticate the signer. The
Signing Service MUST NOT generate the requested signature unless the
signer is successfully authenticated through this Identity Provider.</p>
<p><a name="signrequester"></a></p>
<h5 id="2135-signrequester">2.1.3.5. SignRequester</h5>
<p>This element MUST be present, specifying the identity of the Requesting
Service in the form of its SAML entityID.</p>
<p><a name="signservice"></a></p>
<h5 id="2136-signservice">2.1.3.6 SignService</h5>
<p>This element MUST be present, specifying the SAML entityID of the
Signing Service that is the target of this sign request.</p>
<p><a name="requestedsignaturealgorithm"></a></p>
<h5 id="2137-requestedsignaturealgorithm">2.1.3.7. RequestedSignatureAlgorithm</h5>
<p>This element MAY be present, specifying a URI that identifies a
signature algorithm that the Requesting Service prefers to be used when
generating the requested signature.</p>
<p>When this element is absent, the default signing algorithm is RSA with
SHA-256, <code>http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</code>.</p>
<p><a name="signmessage"></a></p>
<h5 id="2138-signmessage">2.1.3.8. SignMessage</h5>
<p><a name="signmessage-element"></a></p>
<h6 id="21381-signmessage-element">2.1.3.8.1. SignMessage Element</h6>
<p>This element MAY be present to provide information that the Identity
Provider MAY display for the user before obtaining the user’s consent to
sign. The message MAY be provided in clear text or in encrypted form.
The attribute <code>MustShow</code> MUST be set to <code>true</code> if the Identity Provider is
required to show this message to the user. When the message is provided
in encrypted form, the <code>DisplayEntity</code> attribute MUST include the entityID
of the Identity Provider holding the private decryption key. The
encryption key included in the metadata of the identified Identity
Provider SHOULD be used to encrypt the message.</p>
<p>The message MUST be encoded using UTF-8 and MUST be using one of the
formats plain text, HTML or markdown. The appropriate MIME type must be
declared in the <code>MimeType</code> attribute.</p>
<p>For messages in HTML format, the message MUST NOT contain tags and
attributes for each tag other than those listed in the following table:</p>
<table>
<thead>
<tr>
<th>HTML Tags</th>
<th>Type</th>
<th>Allowed attributes</th>
</tr>
</thead>
<tbody><tr>
<td>h1, h2, h3, h4</td>
<td>Headings</td>
<td>style</td>
</tr>
<tr>
<td>div, span, p</td>
<td>Section</td>
<td>style</td>
</tr>
<tr>
<td>table, tr, td</td>
<td>Table</td>
<td>style</td>
</tr>
<tr>
<td>b, strong</td>
<td>Highlight</td>
<td>style</td>
</tr>
<tr>
<td>i, u, br</td>
<td>Format</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>ol, ul, li</td>
<td>List</td>
<td>&nbsp;</td>
</tr>
</tbody></table>
<p>Allowed HTML entities for character replacement SHALL be restricted to
<code>amp</code>, <code>gt</code>, <code>lt</code>, <code>quot</code> and <code>nbsp</code> (in the form <code>&amp;entity-name;</code>).</p>
<p>HTML messages MUST NOT contain any URI references to data outside of the
message and MUST NOT contain any JavaScript in any form.</p>
<p><a name="requesting-identity-provider-to-display-signmessage"></a></p>
<h6 id="21382-requesting-identity-provider-to-display-signmessage">2.1.3.8.2. Requesting Identity Provider to Display SignMessage</h6>
<p>The means through which the Service Provider requests the Identity
Provider to display a sign message is defined in section 7.1.1 of “Deployment Profile
for the Swedish eID Framework” [<a href="#eid-profile">Eid-Profile</a>].</p>
<p>In addition to the requirements in section 7.1.1 of [<a href="#eid-profile">Eid-Profile</a>] the 
Signature Service MUST apply the following process regarding the inclusion of the
<code>AuthnContextClassRef</code> URI to include in the <code>AuthnRequest</code> sent to the Identity Provider 
when authenticating the user for signing:</p>
<ol class="list">
<li><p>Determine requested LoA (Level of Assurance) by either:</p>
</li>
<li><p>Get the LoA, or LoA:s, from the <code>AuthnContextClassRef</code> specified in the sign request as <code>CertRequestProperties</code>, or</p>
</li>
<li><p>if the LoA reference from the sign request is absent then use the default LoA according to the governing policy.</p>
</li>
<li><p>Include the LoA URI(s) from the step above as <code>RequestedAuthnContext</code> if supported by the Identity Provider.
If none of the LoA:s are supported by the Identity Provider, fail signing and return an error sign response,
indicating a request failure (the requested LoA(s) was inconsistent with the specified Identity Provider).</p>
</li>
</ol>
<p><a name="certrequestproperties"></a></p>
<h5 id="2139-certrequestproperties">2.1.3.9. CertRequestProperties</h5>
<p>This element MAY be present to provide requested properties of generated
signature certificates according with section 3.1.1 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>When the <code>CertType</code> attribute is present with a value of <code>QC/SSCD</code> the signature service MUST request authentication in accordance with section 7.1.2 of “Deployment Profile for the Swedish eID Framework” [<a href="#eid-profile">Eid-Profile</a>], or reject the request.</p>
<p><a name="authncontextclassref"></a></p>
<h6 id="21391-authncontextclassref">2.1.3.9.1. AuthnContextClassRef</h6>
<p>This element MAY be present to specify the Level of Assurance(s) required
in order to issue the signing certificate. </p>
<p><a name="requestedcertattributes"></a></p>
<h6 id="21392-requestedcertattributes">2.1.3.9.2. RequestedCertAttributes</h6>
<p>This element MAY be present to specify any number of attributes that the
Requesting Service requires or requests to be included as a
representation of the subject in the signature certificate that is
generated with the requested signature.</p>
<p>The Signature Service MUST NOT generate the requested signature unless
it can obtain attribute values from an authoritative source for all
requested attributes that is marked as &quot;required&quot;. The Signature service
SHOULD attempt to provide all &quot;requested&quot; attributes.</p>
<p>The Signing Service MAY use an Attribute Authority as complementary
source to obtain requested attribute values, as long as the identity
assertion provided by the specified Identity Provider is sufficient to
uniquely identify the signer. The Sign Requester MAY provide one or more
SAML entityID identifiers of Attribute Authorities in
<code>&lt;AttributeAuthority&gt;</code> elements, which could be used to obtain an
attribute value for the requested attribute.</p>
<p>It is left to local policy of the Signature Service whether it accepts
any <code>DefaultValue</code> attribute value for any requested attributes as being
provided by an authoritative source. If a <code>DefaultValue</code> is accepted as
authoritative, it MUST NOT conflict with any attributes received by the
specified Identity Provider or Attribute Authority when authenticating
the signer. If the requested attribute is provided by the Identity
Provider or any Attribute Authority used by the Signing Service, then
these values MUST be used over the <code>DefaultValue</code>.</p>
<p><a name="sign-responses"></a></p>
<h3 id="22-sign-responses">2.2. Sign Responses</h3>
<p>Sign responses are carried in a <code>&lt;dss:SignResponse&gt;</code> element
according to requirements and conditions of the following subsections.</p>
<p>The <code>&lt;dss:SignResponse&gt;</code> element MUST have a <code>Profile</code> attribute with
the value <code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>, which
specifies conformance to this implementation profile.</p>
<p>The <code>&lt;dss:SignResponse&gt;</code> element MUST have a <code>RequestID</code> attribute
with a value that is identical to the sign request that is being
serviced through this sign response.</p>
<p><a name="signature-on-sign-responses"></a></p>
<h4 id="221-signature-on-sign-responses">2.2.1. Signature on Sign Responses</h4>
<p>Sign responses MUST be signed. The signature MUST have a Same-Document
URI-Reference (URI=””) to ensure that the signature covers the complete
<code>&lt;dss:SignResponse&gt;</code> element.</p>
<p>The resulting <code>&lt;ds:Signature&gt;</code> element MUST be placed inside the
<code>&lt;dss:OptionalOutputs&gt;</code> element in accordance with section 5 of
[<a href="#dss-ext">DSS-Ext</a>].</p>
<p><a name="sign-response-status-information"></a></p>
<h4 id="222-sign-response-status-information">2.2.2. Sign Response Status Information</h4>
<p>Implementations of this specification MUST return a
<code>&lt;dss:ResultMajor&gt;</code> value and MAY return a <code>&lt;dss:ResultMinor&gt;</code>
value. Implementations of this specification are released from the
requirement to return any of the listed values of
<code>&lt;dss:ResultMinor&gt;</code>, specified in the DSS standard, when returning
the <code>&lt;dss:ResultMajor&gt;</code> value
<code>urn:oasis:names:tc:dss:1.0:resultmajor:Success</code>, since all the listed
<code>&lt;dss:ResultMinor&gt;</code> values relates to signature validation and not
signature creation.</p>
<p>With the exception above, the response values defined in section 2.6 of the DSS standard, amended by status identifiers defined below<sup>*</sup> SHOULD be used.</p>
<p>| <strong>URL</strong> | <strong>Description</strong> |
| :--- | :--- | :--- |
| <code>http://id.elegnamnden.se/sig-status/1.0/req-expired</code> | The time window for the signature request has expired. |
| <code>http://id.elegnamnden.se/sig-status/1.0/user-mismatch</code> | The authenticated user does not match the signer identity attributes in the request.
| <code>http://id.elegnamnden.se/sig-status/1.0/unsupported-loa</code> | The requested level of assurance for user authentication is not supported. |
| <code>http://id.elegnamnden.se/sig-status/1.0/sigmessage-error</code> | A requirement to display sign message was included in the sign request, but the sign service could not establish that the sign message was displayed to the user. |
| <code>http://id.elegnamnden.se/sig-status/1.0/user-cancel</code> | The end user cancelled the signature operation. |
| <code>http://id.swedenconnect.se/sig-status/1.1/authn-failed</code> | The authentication during the signature operation failed. |
| <code>http://id.swedenconnect.se/sig-status/1.1/security-violation</code> | The Signature Service, or Identity Provider authenticating the end user, has detected a security violation (such as a possible fraud). |</p>
<p><strong>Note:</strong> The <code>authn-failed</code> and <code>security-violation</code> codes were introduced for version 1.5 (of [<a href="#dss-ext">DSS-Ext</a>]), and a client not supporting this version will fail to understand these error codes. Whether a Signature Service checks the client version support or not before using these codes are out of scope for this profile. </p>
<blockquote>
<p>[*]: Also listed in section 3.1.7 of [<a href="#eid-registry">Eid-Registry</a>].</p>
</blockquote>
<p><a name="generated-signature"></a></p>
<h4 id="223-generated-signature">2.2.3. Generated Signature</h4>
<p>The generated signature result data SHALL be provided in
<code>&lt;SignTaskData&gt;</code> element according to section 4.1.1 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>One <code>&lt;SignTaskData&gt;</code> element shall be provided for each successfully
generated signature as a result of the corresponding request.</p>
<p><a name="dss-extension"></a></p>
<h4 id="224-dss-extension">2.2.4. DSS Extension</h4>
<p>The <code>&lt;dss:OptionalInput&gt;</code> element of the sign response MUST contain
a <code>&lt;SignResponseExtension&gt;</code> element according to requirements and
conditions of the following subsections.</p>
<p><a name="version2"></a></p>
<h5 id="2241-version">2.2.4.1. Version</h5>
<p>The version of the [<a href="#dss-ext">DSS-Ext</a>] specification under which the 
request was processed and response was constructed. This version MUST be the same
version as given in the <code>SignRequestExtension</code> (see section <a href="#version">2.1.3.1</a>, &quot;<a href="#version">Version</a>)&quot;.</p>
<p>For backwards compatibility reasons that attribute MAY be absent if version &quot;1.1&quot; was requested. 
Otherwise it MUST be set.</p>
<p><a name="responsetime"></a></p>
<h5 id="2242-responsetime">2.2.4.2. ResponseTime</h5>
<p>The <code>&lt;ResponseTime&gt;</code> element MUST be present in the response.</p>
<p><a name="request"></a></p>
<h5 id="2243-request">2.2.4.3. Request</h5>
<p>The <code>&lt;Request&gt;</code> element MAY be present in a response. However, it is RECOMMENDED not to include this
element since it makes the response message unnecessary large. Instead the requester of a sign operation
is expected to save the request message in its session for later use when processing a response message.</p>
<p><a name="signerassertioninfo"></a></p>
<h5 id="2244-signerassertioninfo">2.2.4.4. SignerAssertionInfo</h5>
<p>The <code>&lt;SignerAssertionInfo&gt;</code> element MUST be present if the signer
has been successfully authenticated using the specified Identity
Provider. The present <code>&lt;ContextInfo&gt;</code> child element MUST include an
<code>&lt;AssertionRef&gt;</code> child element. The <code>&lt;AssertionRef&gt;</code> child
element MUST contain the value of the <code>ID</code> attribute of the root element
of the SAML assertion used to authenticate the signer.</p>
<p><a name="signaturecertificatechain"></a></p>
<h5 id="2245-signaturecertificatechain">2.2.4.5. SignatureCertificateChain</h5>
<p>The <code>&lt;SignatureCertificateChain&gt;</code> element MUST be present if a
certificate was issued to the signer. This element MUST provide a
complete chain of certificates up to a self-signed root certificate.</p>
<p>All signature values according to section <a href="#generated-signature">2.2.3</a> MUST be verifiable using
the signer certificate provided in this element.</p>
<p><a name="http-post-binding"></a></p>
<h2 id="3-http-post-binding">3. HTTP POST Binding</h2>
<p>This section specifies the protocol binding
for transport of sign request and sign response messages using HTTP POST. This
protocol binding implements the message exchange model in section <a href="#message-exchange-model">3.1</a>.</p>
<p>This process is technically equivalent to the procedures implemented by
SAML HTTP POST bindings [<a href="#saml2bind">SAML2Bind</a>], section 3.5.</p>
<p><a name="message-exchange-model"></a></p>
<h3 id="31-message-exchange-model">3.1. Message Exchange Model</h3>
<p>Sign request and response messages are exchanged between the Requesting
Service and the Signing Service with the user acting as an intermediary
through a user agent (typically a web browser) according to the
following message flow:</p>
<p><img src="img/dssprof-msg-exch-model.png"></img></p>
<ol class="list">
<li><p>The user agent initiates the signing process by an HTTP request to
 the Service Provider, for example caused by the user clicking a
 button on a web page.</p>
</li>
<li><p>The Service Provider responds to the user agent with an XHTML form,
 containing a Base64 encoded sign request.</p>
</li>
<li><p>A JavaScript in the XHTML form causes the user agent to send the
 sign request to the Signing Service using HTTP POST.</p>
</li>
<li><p>The user interacts with the Signing Service to complete the
 requested signature.</p>
</li>
<li><p>The Signing Service responds to the user agent with an XHTML form,
 containing a Base64 encoded sign response.</p>
</li>
<li><p>A JavaScript in the XHTML form causes the user agent to send the
 sign response to the Service Provider using HTTP POST.</p>
</li>
<li><p>The Service Provider processes the sign response and a confirmation
 or status message is returned to the user agent.</p>
</li>
</ol>
<p>The steps 1,4 and 7 are part of the service infrastructure and are
outside the scope of this HTTP POST binding specification.</p>
<p><a name="sign-request-xhtml-form"></a></p>
<h4 id="311-sign-request-xhtml-form">3.1.1. Sign Request XHTML Form</h4>
<p>The sign request XHTML form SHALL have functional properties that are
equivalent to the following implementation example:</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&#x27;-//W3C//DTD XHTML 1.1//EN&#x27;</span> <span class="hljs-meta-string">&#x27;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&#x27;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&#x27;http://www.w3.org/1999/xhtml&#x27;</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">&#x27;en&#x27;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&#x27;document.forms[0].submit()&#x27;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Note:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Since your browser does not support JavaScript,
    you must press the Continue button once to proceed.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&#x27;https://csig.example.com/signrequest&#x27;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;post&#x27;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;Binding&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;POST/XML/1.0&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;RelayState&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;56345145a482995d&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;EidSignRequest&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;PD94bWw…WVzdD4=&#x27;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;Continue&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>The form’s action attribute specifies the URL to the Signing Service and
the form MUST have a method attribute with the value “post”.</p>
<p>The form MUST provide the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>Binding</td>
<td>“POST/XML/1.0” Identifying implementation of this binding specification</td>
</tr>
<tr>
<td>RelayState</td>
<td>This parameter MUST contain the value of the <code>RequestID</code> attribute of the <code>&lt;dss:SignRequest&gt;</code> element that is present in the base64 encoded sign request.</td>
</tr>
<tr>
<td>EidSignRequest</td>
<td>Base64 encoded sign request.</td>
</tr>
</tbody></table>
<p><a name="sign-response-xhtml-form"></a></p>
<h5 id="312-sign-response-xhtml-form">3.1.2. Sign Response XHTML Form</h5>
<p>The sign response XHTML form SHALL have functional properties that are
equivalent to the following implementation example:</p>
<pre class="hljs"><code><span class="hljs-meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&#x27;-//W3C//DTD XHTML 1.1//EN&#x27;</span> <span class="hljs-meta-string">&#x27;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&#x27;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&#x27;http://www.w3.org/1999/xhtml&#x27;</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">&#x27;en&#x27;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&#x27;document.forms[0].submit()&#x27;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Note:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Since your browser does not support JavaScript,
    you must press the Continue button once to proceed.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&#x27;https://sp.example.com/sigResponseHandler&#x27;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&#x27;post&#x27;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;Binding&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;POST/XML/1.0&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;RelayState&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;56345145a482995d&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;hidden&#x27;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;EidSignResponse&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;PD94bWw…WVzdD4=&#x27;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#x27;Continue&#x27;</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>The form’s action attribute specifies the URL to the requesting Service
Provider. This URL MUST specify a URL from the
<code>&lt;saml:AudienceRestriction&gt;</code> element that was provided in the
corresponding sign request. The form MUST have a method attribute with
the value “post”.</p>
<p>The form MUST provide the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>Binding</td>
<td>“POST/XML/1.0” Identifying implementation of this binding specification</td>
</tr>
<tr>
<td>RelayState</td>
<td>This parameter MUST contain the value of the <code>RequestID</code> attribute of the <code>&lt;dss:SignResponse&gt;</code> element that is present in the base64 encoded sign request.</td>
</tr>
<tr>
<td>EidSignResponse</td>
<td>Base64 encoded sign response.</td>
</tr>
</tbody></table>
<p><a name="references"></a></p>
<h2 id="4-references">4. References</h2>
<p><a name="normative-references"></a></p>
<h3 id="41-normative-references">4.1. Normative References</h3>
<p><a name="rfc2119"></a>
<strong>[RFC2119]</strong></p>
<blockquote>
<p><a href="http://www.ietf.org/rfc/rfc2119.txt">Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997</a>.</p>
</blockquote>
<p><a name="dss"></a>
<strong>[DSS]</strong></p>
<blockquote>
<p><a href="https://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.html">OASIS Standard - Digital Signature Service Core Protocols, Elements, and Bindings Version 1.0, April 11, 2007</a>.</p>
</blockquote>
<p><a name="saml-xsd"></a>
<strong>[SAML-XSD]</strong></p>
<blockquote>
<p>S. Cantor et al., SAML assertions schema. OASIS SSTC, March 2005. Document ID: saml-schema-assertion-2.0. See <a href="http://www.oasisopen.org/committees/security/">http://www.oasisopen.org/committees/security/</a>.</p>
</blockquote>
<p><a name="xmlsig"></a>
<strong>[XMLSig]</strong></p>
<blockquote>
<p>D. Eastlake et al, <a href="https://www.w3.org/TR/2002/REC-xmldsig-core-20020212/">XML-Signature Syntax and Processing, W3C Recommendation, February 2002</a>.</p>
</blockquote>
<p><a name="xmlsig-xsd"></a>
<strong>[XMLSig-XSD]</strong></p>
<blockquote>
<p>XML Signature Schema. World Wide Web Consortium. See <a href="https://www.w3.org/TR/xmldsig-core/xmldsig-core-schema.xsd">https://www.w3.org/TR/xmldsig-core/xmldsig-core-schema.xsd</a>.</p>
</blockquote>
<p><a name="eid-profile"></a>
<strong>[Eid-Profile]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/02_-_Deployment_Profile_for_the_Swedish_eID_Framework.html">Deployment Profile for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="dss-ext"></a>
<strong>[DSS-Ext]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/09_-_DSS_Extension_for_Federated_Signing_Services.html">DSS Extension for Federated Central Signing Services</a>.</p>
</blockquote>
<p><a name="eid-registry"></a>
<strong>[Eid-Registry]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/03_-_Registry_for_Identifiers.html">Swedish eID Framework - Registry for identifiers</a>.</p>
</blockquote>
<p><a name="informative-references"></a></p>
<h3 id="42-informative-references">4.2. Informative References</h3>
<p><a name="saml2bind"></a>
<strong>[SAML2Bind]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf">OASIS Standard, Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0, March 2005</a>.</p>
</blockquote>
<p><a name="changes-between-versions"></a></p>
<h2 id="5-changes-between-versions">5. Changes between versions</h2>
<p><strong>Changes between version 1.5 and version 1.6:</strong></p>
<ul class="list">
<li><p>Section 2.2.2, &quot;Sign Response Status Information&quot;, now defines the DSS status codes previously only appearing in [[Eid-Registry(#eid-registry)]. The status codes <code>http://id.swedenconnect.se/sig-status/1.1/authn-failed</code> and <code>http://id.swedenconnect.se/sig-status/1.1/security-violation</code> were also introduced.</p>
</li>
<li><p>Section 2.1.3.2, &quot;Conditions&quot;, was updated with requirements on how to interpret <code>NotBefore</code> and/or <code>NotOnOrAfter</code> values.</p>
</li>
</ul>
<p><strong>Changes between version 1.4 and version 1.5:</strong></p>
<ul class="list">
<li><p>The requirements in section 2.2.4.3, &quot;Request&quot;, were updated. The <code>Request</code> element is no longer mandatory to include in a response message.</p>
</li>
<li><p>Sections 2.1.3.1 and 2.2.4.1 defining the requirements concerning the use of the <code>Version</code> attribute in <code>SignRequestExtension</code> and <code>SignResponseExtension</code> elements were updated in order to implement support for newer versions of the DSS extension specification.</p>
</li>
<li><p>Section 2.1.3.3, &quot;Signer&quot;, was updated so that it is no longer required to supply the <code>&lt;csig:Signer&gt;</code> element. This enables use cases where the user is not known at the time of signature initiation.  </p>
</li>
</ul>
<p><strong>Changes between version 1.3 and version 1.4:</strong></p>
<ul class="list">
<li><p>Updates of references and change of logotype.</p>
</li>
<li><p>Updates to section 2.1.3.8.2, &quot;Requesting Identity Provider to Display SignMessage&quot;, with a more simple
process of determining the Level of Assurance URI to include in requests.</p>
</li>
</ul>
<p><strong>Changes between version 1.2 and version 1.3:</strong></p>
<ul class="list">
<li>In section 2.1.3.9, &quot;CertRequestProperties&quot;, an requirement to adapt authentication request procedures when the requested signature is a qualified electronic signature was added.</li>
</ul>
<p><strong>Changes between version 1.1 and version 1.2:</strong></p>
<ul class="list">
<li>In section 2.2.2, a reference to section 3.1.5 in [Eid-Registry] was changed to section 3.1.7.</li>
</ul>
<p><strong>Changes between version 1.0 and version 1.1:</strong></p>
<ul class="list">
<li><p>This profile now refers to version 1.1 of the “DSS Extensions for
  Federated Central Signing Services” specification.</p>
</li>
<li><p>Changes were made to section 2.1.3.8, “SignMessage”, in order to
  define usage of the <code>&lt;SignMessage&gt;</code> element.</p>
</li>
<li><p>The URI identifier that identifies this profile has been changed
  from <code>http://id.elegnamnden.se/csig/1.0/eid2-dss/profile</code> to
  <code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>.</p>
</li>
</ul>
    </article>
  </body>
</html>
