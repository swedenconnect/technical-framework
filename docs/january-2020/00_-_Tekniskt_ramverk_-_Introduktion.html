<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>En introduktion till Sweden Connect Tekniskt ramverk</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/eln-portrait.css" media="print" >
    <link type="text/css" rel="stylesheet" href="assets/css/eln-custom.css" media="print" >
  </head>
  <body>
    <article class="markdown-body"><p>
<img align="left" src="img/sweden-connect.png"></img>
<img align="right" src="img/digg_centered.png"></img>
</p>
<p>
<img align="center" src="img/transparent.png"></img>
</p>

<h1 id="en-introduktion-till-sweden-connect-tekniskt-ramverk">En introduktion till Sweden Connect Tekniskt ramverk</h1>
<h3 id="2020-01-17">2020-01-17</h3>
<p>Diarienummer: <strong>2019-267</strong> (<em>tidigare: ELN-0600</em>)</p>
<hr>
<p class="copyright-statement">
Copyright &copy; <a href="https://www.digg.se">Myndigheten för digital förvaltning (DIGG)</a>, 2015-2020.
</p>

<h2 id="innehållsförteckning">Innehållsförteckning</h2>
<ol class="list">
<li><p><a href="#introduktion"><strong>Introduktion</strong></a></p>
<p> 1.1. <a href="#oeversikt">Översikt</a></p>
<p> 1.2. <a href="#tillitsramverk-och-saekerhetsnivaaer">Tillitsramverk och säkerhetsnivåer</a></p>
<p> 1.3. <a href="#tjaenst-foer-insamling-administration-och-publicering-av-metadata">Tjänst för insamling, administration och publicering av metadata</a></p>
<p> 1.4. <a href="#anvisningstjaenst">Anvisningstjänst</a></p>
<p> 1.5. <a href="#integration-hos-foerlitande-part">Integration hos förlitande part</a></p>
<p> 1.6. <a href="#underskrift">Underskrift</a></p>
<p> 1.7. <a href="#tekniskt-ramverk-och-eidas">Tekniskt ramverk och eIDAS</a></p>
<p> 1.7.1. <a href="#autentiseringar-med-utlaendska-e-legitimationer">Autentiseringar med utländska e-legitimationer</a></p>
<p> 1.7.2. <a href="#underskrifter-med-utlaendska-e-legitimationer">Underskrifter med utländska e-legitimationer</a></p>
<p> 1.7.3. <a href="#hantering-av-identiteter">Hantering av identiteter</a></p>
<p> 1.7.4. <a href="#svenska-e-legitimationer-i-utlaendska-e-tjaenster">Svenska e-legitimationer i utländska e-tjänster</a></p>
</li>
<li><p><a href="#tekniska-specifikationer"><strong>Tekniska specifikationer</strong></a></p>
<p> 2.1. <a href="#saml-profiler">SAML-profiler</a></p>
<p> 2.1.1. <a href="#deployment-profile-for-the-swedish-eid-framework">Deployment Profile for the Swedish eID Framework</a></p>
<p> 2.1.2. <a href="#swedish-eid-framework-registry-for-identifiers">Swedish eID Framework - Registry for identifiers</a></p>
<p> 2.1.3. <a href="#attribute-specification-for-the-swedish-eid-framework">Attribute Specification for the Swedish eID Framework</a></p>
<p> 2.1.4. <a href="#entity-categories-for-the-swedish-eid-framework">Entity Categories for the Swedish eID Framework</a></p>
<p> 2.1.5. <a href="#eidas-constructed-attributes-specification-for-the-swedish-eid-framework">eIDAS Constructed Attributes Specification for the Swedish eID Framework</a></p>
<p> 2.1.6. <a href="#bankid-profile">Implementation Profile for BankID Identity Providers within the Swedish eID Framework</a></p>
<p> 2.1.7. <a href="#principal-selection-in-saml-authentication-requests">Principal Selection in SAML Authentication Requests</a></p>
<p> 2.2. <a href="#specifikationer-foer-underskrift">Specifikationer för Underskrift</a></p>
<p> 2.2.1. <a href="#implementation-profile-oasis-dss">Implementation Profile for using OASIS DSS in Central Signing Services</a></p>
<p> 2.2.2. <a href="#dss-extensions">DSS Extension for Federated Central Signing Services</a></p>
<p> 2.2.3. <a href="#certificate-profile-css">Certificate Profile for Certificates Issued by Central Signing Services
</a></p>
<p> 2.2.4. <a href="#signature-activation">Signature Activation Protocol for Federated Signing</a></p>
</li>
<li><p><a href="#referenslista"><strong>Referenslista</strong></a></p>
<p> 3.1. <a href="#digg">DIGG</a></p>
<p> 3.2. <a href="#oevriga-referenser">Övriga referenser</a></p>
</li>
</ol>
<p><a name="introduktion"></a></p>
<h2 id="1.-introduktion">1. Introduktion</h2>
<p><a name="oeversikt"></a></p>
<h3 id="1.1.-översikt">1.1. Översikt</h3>
<p>Sweden Connect Tekniskt Ramverk är anpassat för
identitetsfederationer som baseras på SAML 2.0.</p>
<p>Förlitande parter erhåller identitetsintyg i ett standardiserat format
från en legitimeringstjänst<sup>1</sup>.</p>
<p>E-tjänster som kräver underskrift behöver inte anpassas efter olika 
användares e-legitimationer för att skapa elektroniska underskrifter. 
Istället överlåter e-tjänsten detta till en underskriftstjänst där användare 
med stöd av legitimering via en legitimeringstjänst ges möjlighet att underteckna
elektroniska handlingar.</p>
<p>Inom federationen intar e-tjänster och motsvarande förlitande parter
rollen som Service Provider (SP) medan legitimeringstjänster som
utfärdar identitetsintyg intar rollen som Identity Provider (IdP) och
därmed den som autentiserar användaren, oavsett mot vilken e-tjänst som
användaren legitimerar sig.</p>
<p>För de fall där e-tjänsten behöver mer information om användaren t ex.
uppgift om juridisk behörighet, kan en fråga ställas till en
attributtjänst, Attribute Authority (AA), inom federationen, om sådan
relevant attributtjänst finns. Genom en attributsförfrågan kan
e-tjänsten erhålla nödvändig kompletterande information för att kunna
auktorisera användaren och ge tillgång till e-tjänsten eller
motsvarande.</p>
<p>Då såväl personidentitetsuppgifter som andra attribut kopplat till
användare tillhandahålls genom identitetsintyg och attributsintyg, kan
alla typer av e-legitimationer som förlitande part har avtal om och som
ingår i federationen användas för legitimering mot en e-tjänst som
kräver såväl personnummer som ytterligare information, även om 
e-legitimationen inte innehåller några specifika personuppgifter 
(t.ex. koddosor för generering av engångslösenord).</p>
<p class="img-container"><img src="img/sweeid-overview1.jpg" alt=""></p>
<p>Figur 1: <em>Illustration av kommunikationen mellan de olika tjänsterna inom
en identitetsfederation.</em></p>
<blockquote>
<p>[1]: Legitimeringstjänst benämns i annan dokumentation från DIGG också som identitetstjänst och intygstjänst. I detta dokument används dock uteslutande benämningen legitimeringstjänst.</p>
</blockquote>
<p><a name="tillitsramverk-och-saekerhetsnivaaer"></a></p>
<h3 id="1.2.-tillitsramverk-och-säkerhetsnivåer">1.2. Tillitsramverk och säkerhetsnivåer</h3>
<p>Grunden för vilken säkerhetsnivå som tillämpas när en användare
legitimerar sig är den tillitsnivå avseende e-legitimationen som
e-tjänsten kräver. För att dessa säkerhetsnivåer ska kunna vara
jämförbara inom ramen för federationen definieras fyra tillitsnivåer (1
– 4) i Tillitsramverket för Svensk e-legitimation [<a href="#eidtillit">EidTillit</a>] och tre
tillitsnivåer (låg, väsentlig, hög) i EU-förordningen eIDAS. Alla som
utfärdar identitetsintyg måste visa att hela den process som ligger till
grund för utfärdandet av identitetsintyg uppfyller kraven i den
efterfrågade tillitsnivån, detta innefattar bl.a.</p>
<ul class="list">
<li><p>Krav på skapandet av identitetsintyget.</p>
</li>
<li><p>Krav på den elektroniska legitimeringen (autentiseringen).</p>
</li>
<li><p>Krav på utfärdandeprocessen.</p>
</li>
<li><p>Krav på själva e-legitimationen och dess användning.</p>
</li>
<li><p>Krav på utfärdaren av e-legitimationen.</p>
</li>
<li><p>Krav på fastställande av den e-legitimationssökandens identitet.</p>
</li>
</ul>
<p><a name="tjaenst-foer-insamling-administration-och-publicering-av-metadata"></a></p>
<h3 id="1.3.-tjänst-för-insamling,-administration-och-publicering-av-metadata">1.3. Tjänst för insamling, administration och publicering av metadata</h3>
<p>En SAML-federation tillhandahåller information om federationens
deltagare genom SAML metadata. Som deltagare i en federation räknas
såväl aktörer som levererar legitimerings- och attributtjänster i
federationen som förlitande parter, d.v.s. aktörer som konsumerar dessa
tjänster, t ex. e-tjänster.</p>
<p>Genom federationens metadata kan deltagare inhämta information om andra
deltagares tjänster, inklusive de uppgifter som krävs för ett säkert
informationsutbyte mellan deltagarna. Metadata måste hållas uppdaterat
av respektive part och överensstämma med avtalade förhållanden.</p>
<p>Det viktigaste syftet med metadata är att tillhandahålla de nycklar/certifikat 
som krävs för säker kommunikation och informationsutväxling mellan tjänster.
Utöver nycklar innehåller metadata även annan information som är viktig
för samverkan mellan tjänster t ex. adresser till funktioner som krävs,
information om tillitsnivåer, tjänstekategorier,
användargränssnittsinformation mm.</p>
<p>En identitetsfederation definieras av ett register i XML-format som är
signerat med federationsoperatörens certifikat. Filen innehåller
information om identitetsfederationens medlemmar inklusive deras
certifikat. Eftersom filen med metadata är signerad räcker det med att
jämföra ett certifikat med dess motsvarighet i metadata. En
infrastruktur baserad på ett centralt federationsregister förutsätter
att registret uppdateras kontinuerligt samt att federationsmedlemmarna
alltid använder den senaste versionen av filen.</p>
<p><a name="anvisningstjaenst"></a></p>
<h3 id="1.4.-anvisningstjänst">1.4. Anvisningstjänst</h3>
<p>I en identitetsfederation är det möjligt att erbjuda och konsumera en
gemensam anvisningstjänst (Discovery Service), som listar vilka
legitimeringstjänster som är möjliga för användaren att välja mellan.
Syftet med en sådan anvisningstjänst är att avlasta de enskilda
e-tjänsterna som ingår i identitetsfederationen från att själva
implementera stöd för hur användare väljer legitimeringstjänst (eller
inloggningsmetod).</p>
<p>Genom att anvisningstjänsten finns tillgänglig inom
identitetsfederationen kan e-tjänster styra sina användare dit för val
av legitimeringstjänst. Anvisningstjänsten interagerar med användaren
som gör sitt val och användaren, tillsammans med dennes val, styrs
tillbaka till e-tjänsten som nu vet till vilken legitimeringstjänst
användaren ska skickas för legitimering.</p>
<blockquote>
<p>För närvarande finns ingen gemensam anvisningstjänst för Sweden Connect-federationen.</p>
</blockquote>
<p><a name="integration-hos-foerlitande-part"></a></p>
<h3 id="1.5.-integration-hos-förlitande-part">1.5. Integration hos förlitande part</h3>
<p>Förlitandeparter, t.ex. e-tjänster, integrerar mot legitimeringstjänster
genom standardiserade meddelanden och konsumerar identitetsintyg vilka
också har standardiserade format.</p>
<p>Sweden Connect tekniskt ramverk är influerad av interoperabilitetsprofilen 
”SAML V2.0 Deployment Profile for Federation Interoperability”
[<a href="#saml2int">SAML2Int</a>]. Profilen stöds av ett flertal kommersiella 
produkter och Open Source-lösningar, vilket underlättar integrationsarbetet
hos e-tjänster.</p>
<p>Många e-tjänster använder fristående autentiseringslösningar vilket
innebär att en anpassning av integrationen för att följa
tekniskt ramverk får en begränsad påverkan på e-tjänsten som sådan.</p>
<p><a name="underskrift"></a></p>
<h3 id="1.6.-underskrift">1.6. Underskrift</h3>
<p>Vid underskrift blir det med Sweden Connect tekniskt ramverk
möjligt att använda olika typer av e-legitimationer, även sådana som
inte är certifikatbaserade, utan att speciella anpassningar i e-tjänsten
behövs. Anledningen är att det är det elektroniskt utställda
identitetsintyget (som används för identifiering av användare vid
underskrift) har samma format oavsett vilken typ av e-legitimation som
användaren använder.</p>
<p>En underskriftstjänst har som syfte att möjliggöra underskrift inom
identitetsfederationer som följer tekniskt ramverk med stöd av alla 
typer av e-legitimationer som erbjuder tillräcklig grad av säkerhet.</p>
<p>Genom att upphandla<sup>1</sup> och införa en underskriftstjänst kan en förlitande
part som ingår i federationen låta en användare skriva under en
elektronisk handling med stöd av underskriftstjänsten.
Användarens elektroniska signatur och tillhörande signeringscertifikat
skapas av underskriftstjänsten efter det att användaren accepterat att
skriva under genom att legitimera sig mot underskriftstjänsten<sup>2</sup>.</p>
<blockquote>
<p>[1]: Det är också möjligt att själv implementera en underskriftstjänst baserat på specifikationerna i tekniskt ramverk, eller på annat sätt införskaffa en underskriftstjänst.</p>
<p>[2]: Viktigt att påpeka är att det är av största vikt att användaren upplever det som att denne skriver under en handling. Därför ska ett underskriftsflöde användas för de e-legitimationer som stödjer detta i samband med &quot;legitimering för underskrift&quot;.</p>
</blockquote>
<p><a name="tekniskt-ramverk-och-eidas"></a></p>
<h3 id="1.7.-tekniskt-ramverk-och-eidas">1.7. Tekniskt ramverk och eIDAS</h3>
<p>EU-förordningen (<a href="http://eur-lex.europa.eu/legal-content/SV/TXT/PDF/?uri=CELEX:32014R0910&amp;from=EN">910/2014</a>) om elektronisk identifiering och betrodda
tjänster, eIDAS, ställer krav på svenska offentliga organ att erkänna de
e-legitimationer som andra eIDAS-länder har anmält. Detta innebär att en
offentlig svensk e-tjänst baserat på vissa regler skall kunna acceptera
en inloggning som utförs med en e-legitimation utställd i ett annat
land.</p>
<p><a name="autentiseringar-med-utlaendska-e-legitimationer"></a></p>
<h4 id="1.7.1.-autentiseringar-med-utländska-e-legitimationer">1.7.1. Autentiseringar med utländska e-legitimationer</h4>
<p>De tekniska specifikationerna för eIDAS bygger, såsom
tekniskt ramverk, på SAML-standarder, och även
om likheterna är många finns även skillnader i dessa specifikationer. En
svensk e-tjänst ska dock inte förhålla sig direkt till eIDAS tekniska
specifikationer. Nedanstående bild illustrerar hur
den svenska eIDAS-noden (<em>eIDAS-connector</em>) agerar som en brygga
mellan andra länder och den svenska federationen då en person autentiseras
med en utländsk e-legitimation mot en svensk e-tjänst.
Den svenska eIDAS-noden följer tekniskt ramverk.</p>
<p class="img-container"><img src="img/eidas-flow.jpg" alt=""></p>
<p>Flödet är enligt följande:</p>
<ol class="list">
<li><p>En användare med en utländsk e-legitimation begär åtkomst till en
svensk e-tjänst (d.v.s., loggar in).</p>
</li>
<li><p>E-tjänsten låter användaren välja inloggningssätt med hjälp av en
anvisningstjänst. Ett val ”Foreign eID” visas upp, vilket användaren
i eIDAS-fallet väljer.</p>
</li>
<li><p>E-tjänsten skapar en legitimeringsbegäran enligt detta tekniska
ramverk och styr användaren till den svenska eIDAS-noden (<em>connector</em>)
som DIGG ansvarar för. eIDAS-noden uppträder som
en legitimeringstjänst (<em>Identity Provider</em>) i federationen in
mot svenska förlitande parter vilket innebär att kommunikation med
denna tjänst utförs på samma sätt som mot övriga
legitimeringstjänster inom federationer som följer tekniskt ramverk.</p>
</li>
<li><p>Den mottagna begäran behandlas och eIDAS-noden visar upp en valsida
där användaren väljer ”sitt land”<sup>1</sup>. Den svenska eIDAS-noden
omvandlar nu den mottagna legitimeringsbegäran till en
legitimeringsbegäran enligt eIDAS och användaren styrs till det
valda landets ”eIDAS Proxy-tjänst”.</p>
</li>
<li><p>Då legitimeringsbegäran mottas av den eIDAS-Proxy-tjänst för valt
land tar detta lands teknik för autentisering över. Inte alla länder
inom eIDAS använder SAML för autentisering, men om så var fallet i
vårt exempel skulle användaren styras vidare till en
legitimeringstjänst (<em>Identity Provider</em>), och innan dess kanske även
en anvisningstjänst för val av legitimeringstjänst.</p>
</li>
<li><p>Då en autentisering utförts skapas ett intyg (<em>Assertion</em>) enligt
eIDAS specifikationer. Detta intyg innehåller bl.a. eIDAS-specifika
attribut som identifierar användaren.</p>
</li>
<li><p>Detta intyg styrs nu vidare till den svenska eIDAS-noden. Noden tar
emot intyget och validerar dess korrekthet. I samband med att
intyget transformeras från eIDAS-format till ett intyg utformat
enligt tekniskt ramverk anropar noden också
en attributtjänst för att, om möjligt, givet eIDAS-attribut erhålla
attribut som stöds av den svenska e-tjänsten (t.ex. slå upp ett
svenskt personnummer givet ett eIDAS <em>PersonIdentifier</em>-attribut)<sup>2</sup>.</p>
</li>
<li><p>Slutligen postas ett intyg, på ett format som uppfyller
tekniskt ramverk, till e-tjänsten.</p>
</li>
<li><p>Förlitande part kompletterar eventuellt med ytterligare information
och avgör om användaren ska ges till åtkomst till tjänsten.</p>
</li>
</ol>
<p>Svenska e-tjänster behöver således endast stödja 
tekniskt ramverk för att kunna hantera en autentisering utförd med en
europeisk e-legitimation. Dock måste e-tjänsten kunna hantera den
identitet som presenteras, vilket inte nödvändigtvis är ett personnummer. 
Det kan alltså hända att en e-tjänst autentiserar en användare via 
eIDAS-ramverket, men att användarens
presenterade identitet inte går att använda hos e-tjänsten. Mer om detta
i kapitlet 1.7.3 nedan.</p>
<blockquote>
<p>[1]: Egentligen väljer användaren till vilken ”eIDAS Proxy-tjänst” som begäran ska skickas vidare till. Detta är beroende landstillhörigheten för användarens e-legitimationsutfärdare.</p>
<p>[2]: I skrivande stund (september 2019) finns ingen attributtjänst som utför koppling mellan eIDAS-identiteter och svenska personnummer.</p>
</blockquote>
<p><a name="underskrifter-med-utlaendska-e-legitimationer"></a></p>
<h4 id="1.7.2.-underskrifter-med-utländska-e-legitimationer">1.7.2. Underskrifter med utländska e-legitimationer</h4>
<p>Som redan beskrivits tillämpas en modell för
elektronisk underskrift inom ramen för detta tekniska ramverk
som kallas federerad underskrift. En
serverbaserad underskriftstjänst knyts till e-tjänsten som i sin tur
begär underskrift. När en användare skriver under ett dokument skickar
e-tjänsten en underskriftsbegäran till underskriftstjänsten.
Underskriftstjänsten begär därefter att användaren legitimerar sig. I
samband med legitimeringen godkänner användaren underskriften.
Underskriftstjänsten skickar tillbaka uppgifter till e-tjänsten och
därefter lagras underskriftsuppgifterna kopplade till den handling som
har skrivits under.</p>
<p>Detta förfarande möjliggör att skriva under även med utländsk
e-legitimation då underskriftstjänsten kan välja att legitimera
användaren med utländsk e-legitimation i enlighet med förfarandet som
beskrivs ovan i avsnitt 1.7.1.</p>
<p>Vid en underskrift ansvarar i det fallet den svenska eIDAS-noden för att
användaren upplyses om att syftet med legitimeringen är att skriva under
ett dokument, vem som begärt underskrift samt med eventuell information
om vad som undertecknas. Först när användaren genom att legitimera sig
(för underskrift) utfärdas ett identitetsintyg, som skickas till
underskriftstjänsten och som i sin tur genererar underskriften.</p>
<p><a name="hantering-av-identiteter"></a></p>
<h4 id="1.7.3.-hantering-av-identiteter">1.7.3. Hantering av identiteter</h4>
<p>Identitetsintyg från andra länder följer EU-gemensamma tekniska
specifikationer framtagna inom ramen för eIDAS-regelverket. Här
specificeras de attribut som varje land alltid måste skicka med för
fysiska personer såväl som för organisationer (”Minimum Dataset”, MDS).
Varje land måste skicka med en unik identifierare per e-legitimation som
representerar endast en fysisk person. Från vissa länder kommer dessa
identifierare vara unika och beständiga per person på motsvarande sätt
som t.ex. svenska personnummer, men dessa identifierare kan ha vitt
skilda sammansättningar och ha väldigt olika egenskaper. En egenskap som
kan variera är hur persistent en sådan identifierare är, d.v.s., om en
sådan identifierare är oförändrad under en persons livstid eller om den
ändras om personen exempelvis flyttar till en annan region, byter namn
eller bara byter e-legitimation. Från några länder (t.ex.
Storbritannien) kommer identifieraren att vara olika beroende på vilken
av landets e-legitimationer en användare för tillfället väljer att
använda.</p>
<p>För att förenkla hanteringen av användare i svenska e-tjänster
genererar den svenska eIDAS-noden ett standardiserat ID-attribut för
användare som legitimerats med utländsk e-legitimation, ett s.k.
<em>provisional ID</em> (förkortat PRID). Dessutom skapas ett tillhörande
attribut som deklarerar vilken förväntad persistens, eller livslängd,
detta ID-attribut har. PRID-attributet genereras utifrån de
attributvärden som erhålls från den utländska legitimeringen enligt
specificerade metoder för respektive land. Varje kombination av land och
metod klassas med avseende på förväntad persistens, d.v.s., hur
sannolikt det är att en identitet ändras över tiden för samma person.
Detta gör det möjligt för svenska e-tjänster att anpassa kommunikationen
med användaren och proaktivt tillhandahålla funktioner som underlättar
för en användare vars identitet har ändrats, att återfå kontrollen över
sin information i e-tjänsten.</p>
<p>I vissa fall kan en person som legitimeras med en utländsk
e-legitimation även inneha ett svenskt personnummer. Det kan till exempel 
röra sig om en svensk medborgare som flyttat utomlands och skaffat utländsk e-legitimation
eller en utländsk medborgare som är folkbokförd i Sverige och har tilldelats ett
personnummer.</p>
<p>Det faktum att en person med utländsk e-legitimation innehar ett svenskt
personnummer är normalt sett inte känt för den
utländska legitimeringstjänsten och denna information ingår därför inte
i identitetsintyg från landet där personen legitimeras. Den svenska
noden har däremot möjlighet att fråga en attributtjänst i Sverige<sup>1</sup> om
det finns ett registrerat personnummer för den
legitimerade personen och kan, om så är fallet, påföra sådan information
i det identitetsintyg som skickas till e-tjänsten.</p>
<blockquote>
<p>[1]: I skrivande stund (september 2019) finns ingen attributtjänst som utför koppling mellan eIDAS-identiteter och svenska personnummer.</p>
</blockquote>
<p><a name="svenska-e-legitimationer-i-utlaendska-e-tjaenster"></a></p>
<h4 id="1.7.4.-svenska-e-legitimationer-i-utländska-e-tjänster">1.7.4. Svenska e-legitimationer i utländska e-tjänster</h4>
<p>Sverige har möjlighet att anmäla svenska e-legitimationer på tillitsnivå låg (low), väsentlig (substantial) och hög (high) enligt eIDAS. Det finns en politisk vilja i Sverige att låta innehavare av svenska e-legitimationer logga in i utländska tjänster<sup>1</sup>.</p>
<p>En begäran om legitimering från en utländsk e-tjänst ställs till den svenska eIDAS-noden (proxy-tjänst) via en s.k. eIDAS-connector i e-tjänstens land. 
I den svenska eIDAS-noden väljer användaren med vilken svensk e-legitimation denne önskar autentisera sig, varpå en legitimeringsbegäran till den legitimeringstjänst (<em>Identity Provider</em>) som hanterar vald e-legitimation skickas. Denna begäran är utformad enligt tekniskt ramverk vilket innebär att en svensk legitimeringstjänst inte behöver förhålla sig till eIDAS tekniska specifikationer.</p>
<p>Användaren autentiseras hos den svenska legitimeringstjänsten och ett identitetsintyg ställs ut (enligt tekniskt ramverk). Detta intyg mottas av den svenska eIDAS Proxy-tjänsten och omvandlas till ett intyg enligt eIDAS specifikationer innan det skickas vidare till den utländska eIDAS-connectorn och därpå till den anropande e-tjänsten (<em>Service Provider</em>).</p>
<blockquote>
<p>[1]: Projektet för att anmäla svenska e-legitimationer för användande inom eIDAS-samarbetet
påbörjades under september 2019. </p>
</blockquote>
<p><a name="tekniska-specifikationer"></a></p>
<h2 id="2.-tekniska-specifikationer">2. Tekniska specifikationer</h2>
<p>Detta kapitel innehåller specifikationer och profiler för
identitetsfederationer som följer Sweden Connect tekniskt
ramverk, och vissa kringliggande tjänster. Där inget annat nämns är
dessa dokument normativa för leverans av tjänster inom
identitetsfederationer som implementerar 
tekniskt ramverk.</p>
<p><a name="saml-profiler"></a></p>
<h3 id="2.1.-saml-profiler">2.1. SAML-profiler</h3>
<p>Identitetsfederationer som följer Sweden Connect tekniska ramverk är uppbyggda
kring ”Deployment Profile for the Swedish eID Framework”, [[EidProfile](#eidprofile)]. Denna profil är influerad av, men inte normativt beroende på, ”SAML V2.0 Deployment Profile for Federation Interoperability” [<a href="#saml2int">SAML2Int</a>]. [[EidProfile](#eidprofile)] innehåller också regler och riktlinjer specifika för Sweden Connect tekniskt ramverk. </p>
<p><a name="deployment-profile-for-the-swedish-eid-framework"></a></p>
<h4 id="2.1.1.-deployment-profile-for-the-swedish-eid-framework">2.1.1. Deployment Profile for the Swedish eID Framework</h4>
<p>”Deployment Profile for the Swedish eID Framework”, [[EidProfile](#eidprofile)], är huvuddokumentet för tekniskt ramverk och specificerar bland annat:</p>
<ul class="list">
<li><p>Hur SAML metadata ska byggas upp och tolkas.</p>
</li>
<li><p>Hur formatet av en legitimeringsbegäran ska se ut.</p>
</li>
<li><p>Hur en legitimeringsbegäran ska behandlas, och hur ett identitetsintyg ska konstrueras, verifieras och behandlas.</p>
</li>
<li><p>Krav på säkerhet.</p>
</li>
<li><p>Specifika SAML-krav för underskriftstjänster och &quot;legitimering för underskrift&quot;.</p>
</li>
</ul>
<p><a name="swedish-eid-framework-registry-for-identifiers"></a></p>
<h4 id="2.1.2.-swedish-eid-framework---registry-for-identifiers">2.1.2. Swedish eID Framework - Registry for identifiers</h4>
<p>Implementering av en infrastruktur för Svensk e-legitimation kräver
olika former av identifierare för att representera objekt i
datastrukturer. Dokumentet ”Swedish eID Framework - Registry for identifiers”, [<a href="#eidregistry">EidRegistry</a>], definierar strukturen
för identifierare som tilldelats inom ramen för tekniskt ramverk, samt ett
register över definierade identifierare.</p>
<p><a name="attribute-specification-for-the-swedish-eid-framework"></a></p>
<h4 id="2.1.3.-attribute-specification-for-the-swedish-eid-framework">2.1.3. Attribute Specification for the Swedish eID Framework</h4>
<p>Specifikationen ”Attribute Specification for the Swedish eID Framework”,
[<a href="#eidattributes">EidAttributes</a>], deklarerar de SAML attributprofiler som används inom
identitetsfederationer som följer tekniskt ramverk inklusive de som
ansluter till eIDAS via den svenska eIDAS-noden.</p>
<p><a name="entity-categories-for-the-swedish-eid-framework"></a></p>
<h4 id="2.1.4.-entity-categories-for-the-swedish-eid-framework">2.1.4. Entity Categories for the Swedish eID Framework</h4>
<p>Entitetskategorier (Entity Categories) används inom federationen för ett antal olika
syften:</p>
<ul class="list">
<li><p>Service Entity Categories – Används i metadata för att
representera e-tjänsters krav på tillitsnivåer och begärda attribut,
samt legitimeringstjänsters uppfyllande av tillitsnivåer och
leverans av attribut.</p>
</li>
<li><p>Service Property Categories – Används för att representera en viss
egenskap hos en tjänst.</p>
</li>
<li><p>Service Type Entity Categories – Används för att representera olika
tjänstetyper inom federationen.</p>
</li>
<li><p>Service Contract Entity Categories - Används av tjänster för att annonsera 
avtalsformer och liknande.</p>
</li>
<li><p>General Entity Categories - Entitetskategorier som inte faller inom ramen
för någon av de ovanstående typerna.</p>
</li>
</ul>
<p>Specifikationen ”Entity Categories for the Swedish eID Framework”
[<a href="#eidentcat">EidEntCat</a>] specificerar de entitetskategorier som definieras av tekniskt ramverk och beskriver dess betydelse.</p>
<p><a name="eidas-constructed-attributes-specification-for-the-swedish-eid-framework"></a></p>
<h4 id="2.1.5.-eidas-constructed-attributes-specification-for-the-swedish-eid-framework">2.1.5. eIDAS Constructed Attributes Specification for the Swedish eID Framework</h4>
<p>Specifikationen ”eIDAS Constructed Attributes Specification for the Swedish
eID Framework”, [<a href="#eidconstrattributes">EidConstrAttributes</a>], specificerar processer och regler
för hur ID-attribut konstrueras baserat på attribut som tas emot vid
legitimering mot eIDAS.</p>
<p><a name="bankid-profile"></a></p>
<h4 id="2.1.6.-implementation-profile-for-bankid-identity-providers-within-the-swedish-eid-framework">2.1.6. Implementation Profile for BankID Identity Providers within the Swedish eID Framework</h4>
<p>Specifikationen &quot;Implementation Profile for BankID Identity Providers within the Swedish eID Framework&quot;, [<a href="#eidbankid">EidBankID</a>], definierar regler för hur en legitimeringstjänst som implementerar stöd för BankID skall utformas.</p>
<blockquote>
<p><strong>Notera:</strong> Denna specifikation är inte normativ för uppfyllande av tekniskt ramverk. Den är endast relevant för legitimeringstjänster som implementerar stöd för BankID samt e-tjänster som använder dessa. Dock så skall legitimeringstjänster som implementerar stöd för BankID och vill ansluta till Sweden Connect-federationen uppfylla denna specifikation.</p>
</blockquote>
<p><a name="principal-selection-in-saml-authentication-requests"></a></p>
<h4 id="2.1.7.-principal-selection-in-saml-authentication-requests">2.1.7. Principal Selection in SAML Authentication Requests</h4>
<p>Specifikationen &quot;Principal Selection in SAML Authentication Requests&quot;, [<a href="#eidprincipalsel">EidPrincipalSel</a>], definierar en utökning till SAML som möjliggör för en förlitande part att informera en legitimeringstjänst vilken identitet den önskar ska legitimeras.</p>
<p><a name="specifikationer-foer-underskrift"></a></p>
<h3 id="2.2.-specifikationer-för-underskrift">2.2. Specifikationer för Underskrift</h3>
<p>Detta stycke innehåller referenser till de dokument vilka definierar
underskriftstjänster inom federationer som följer Sweden Connect tekniskt
ramverk.</p>
<p><a name="implementation-profile-oasis-dss"></a></p>
<h4 id="2.2.1.-implementation-profile-for-using-oasis-dss-in-central-signing-services">2.2.1. Implementation Profile for using OASIS DSS in Central Signing Services</h4>
<p>Implementationsprofilen ”Implementation Profile for Using OASIS DSS in
Central Signing Services”, [<a href="#eiddssprofile">EidDSSProfile</a>], specificerar en profil för
underskriftsbegäran och respons enligt OASIS standarden ”Digital
Signature Service Core Protocols, Elements, and Bindings”,
[<a href="#dss">DSS</a>].</p>
<p><a name="dss-extensions"></a></p>
<h4 id="2.2.2.-dss-extension-for-federated-central-signing-services">2.2.2. DSS Extension for Federated Central Signing Services</h4>
<p>”DSS Extension for Federated Central Signing Services”, [<a href="#eiddssext">EidDSSExt</a>], är en påbyggnad av 
OASIS standarden ”Digital Signature Service Core Protocols, Elements, and Bindings”, [<a href="#dss">DSS</a>], där definitioner som behövs för underskrift enligt tekniskt ramverk specificeras.</p>
<p><a name="certificate-profile-css"></a></p>
<h4 id="2.2.3.-certificate-profile-for-certificates-issued-by-central-signing-services">2.2.3. Certificate Profile for Certificates Issued by Central Signing Services</h4>
<p>Certifikatprofilen ”Certificate profile for certificates issued by Central Signing services”, [<a href="#eidcertprof">EidCertProf</a>], specificerar innehåll i signeringscertifikat. Denna profil tillämpar en
ny certifikatextension till stöd för underskriftstjänster.</p>
<p>Denna profil refererar till &quot;Authentication Context Certificate Extension&quot;, [<a href="#authcontext">AuthContext</a>], vilken beskriver hur ”Authentication Context” representeras i X.509 certifikat.</p>
<p><a name="signature-activation"></a></p>
<h4 id="2.2.4.-signature-activation-protocol-for-federated-signing">2.2.4. Signature Activation Protocol for Federated Signing</h4>
<p>Specifikationen &quot;Signature Activation Protocol for Federated Signing&quot;, [<a href="#eidsigact">EidSigAct</a>], definierar ett &quot;Signature Activation Protocol&quot; (SAP) för implementation av &quot;Sole Control Assurance Level 2&quot; (SCAL2) enligt standarden &quot;prEN 419241 - Trustworthy Systems Supporting Server Signing&quot;.</p>
<p><a name="referenslista"></a></p>
<h2 id="3.-referenslista">3. Referenslista</h2>
<p><a name="digg"></a></p>
<h3 id="3.1.-digg">3.1. DIGG</h3>
<p><a name="eidtillit"></a>
<strong>[EidTillit]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/mirror/digg/Tillitsramverk-for-Svensk-e-legitimation-2018-158.pdf">Tillitsramverk för Svensk e-legitimation - 2018-158</a></p>
</blockquote>
<p><a name="eidprofile"></a>
<strong>[EidProfile]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/02_-_Deployment_Profile_for_the_Swedish_eID_Framework.html">Deployment Profile for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eidregistry"></a>
<strong>[EidRegistry]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/03_-_Registry_for_Identifiers.html">Swedish eID Framework - Registry for identifiers</a>.</p>
</blockquote>
<p><a name="eidattributes"></a>
<strong>[EidAttributes]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/04_-_Attribute_Specification_for_the_Swedish_eID_Framework.html">Attribute Specification for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eidentcat"></a>
<strong>[EidEntCat]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/06_-_Entity_Categories_for_the_Swedish_eID_Framework.html">Entity Categories for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eidconstrattributes"></a>
<strong>[EidConstrAttributes]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/11_-_eIDAS_Constructed_Attributes_Specification_for_the_Swedish_eID_Framework.html">eIDAS Constructed Attributes Specification for the Swedish eID
Framework</a>.</p>
</blockquote>
<p><a name="eidbankid"></a>
<strong>[EidBankID]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/12_-_BankID_Profile_for_the_Swedish_eID_Framework.html">Implementation Profile for BankID Identity Providers within the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eidprincipalsel"></a>
<strong>[EidPrincipalSel]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/14_-_Principal_Selection_in_SAML_Authentication_Requests.html">Principal Selection in SAML Authentication Requests</a>.</p>
</blockquote>
<p><a name="eiddssprofile"></a>
<strong>[EidDSSProfile]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/07_-_Implementation_Profile_for_using_DSS_in_Central_Signing_Services.html">Implementation Profile for Using OASIS DSS in Central Signing
Services</a>.</p>
</blockquote>
<p><a name="eiddssext"></a>
<strong>[EidDSSExt]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/09_-_DSS_Extension_for_Federated_Signing_Services.html">DSS Extension for Federated Central Signing Services</a>.</p>
</blockquote>
<p><a name="eidcertprof"></a>
<strong>[EidCertProf]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/08_-_Certificate_Profile_for_Central_Signing_Services.html">Certificate profile for certificates issued by Central Signing
services</a>.</p>
</blockquote>
<p><a name="eidsigact"></a>
<strong>[EidSigAct]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/latest/13_-_Signature_Activation_Protocol.html">Signature Activation Protocol for Federated Signing</a>.</p>
</blockquote>
<p><a name="oevriga-referenser"></a></p>
<h3 id="3.2.-övriga-referenser">3.2. Övriga referenser</h3>
<p><a name="saml2int"></a>
<strong>[SAML2Int]</strong></p>
<blockquote>
<p><a href="https://kantarainitiative.github.io/SAMLprofiles/saml2int.html">SAML V2.0 Deployment Profile for Federation Interoperability</a>.</p>
</blockquote>
<p><a name="dss"></a>
<strong>[DSS]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.doc">OASIS Standard – Digital Signature Service Core Protocols, Elements,
and Bindings Version 1.0, April 11,
2007</a>.</p>
</blockquote>
<p><a name="authcontext"></a>
<strong>[AuthContext]</strong></p>
<blockquote>
<p><a href="https://tools.ietf.org/html/rfc7773">RFC-7773: Authentication Context Certificate Extension</a>.</p>
</blockquote>
    </article>
  </body>
</html>
