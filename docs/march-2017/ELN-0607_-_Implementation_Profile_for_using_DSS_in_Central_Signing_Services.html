<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Implementation Profile for using OASIS DSS in Central Signing Services</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/eln-portrait.css" media="print" >
    <link type="text/css" rel="stylesheet" href="assets/css/eln-custom.css" media="print" >
  </head>
  <body>
    <article class="markdown-body"><p><img src="img/eln-logo.png"></img></p>
<h1 id="implementation-profile-for-using-oasis-dss-in-central-signing-services">Implementation Profile for using OASIS DSS in Central Signing Services</h1>
<h3 id="version-1.2---2017-03-28">Version 1.2 - 2017-03-28</h3>
<p><em>ELN-0607-v1.2</em></p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol class="list">
<li><p><a href="#introduction"><strong>Introduction</strong></a></p>
<p> 1.1. <a href="#terminology">Terminology</a></p>
<p> 1.2. <a href="#requirement-key-words">Requirement key words</a></p>
<p> 1.3. <a href="#name-space-references">Name space references</a></p>
<p> 1.4. <a href="#identification">Identification</a></p>
<p> 1.5. <a href="#structure">Structure</a></p>
</li>
<li><p><a href="#sign-request-and-response-messages"><strong>Sign request and response messages</strong></a></p>
<p> 2.1. <a href="#sign-requests">Sign Requests</a></p>
<p> 2.1.1. <a href="#signature-on-sign-requests">Signature on sign requests</a></p>
<p> 2.1.2. <a href="#data-to-be-signed">Data to be signed</a></p>
<p> 2.1.3. <a href="#dss-extension">DSS extension</a></p>
<p> 2.1.3.1. <a href="#version">Version</a></p>
<p> 2.1.3.2. <a href="#conditions">Conditions</a></p>
<p> 2.1.3.3. <a href="#signer">Signer</a></p>
<p> 2.1.3.4. <a href="#identityprovider">IdentityProvider</a></p>
<p> 2.1.3.5. <a href="#sign-requester">Sign Requester</a></p>
<p> 2.1.3.6 <a href="#signservice">SignService</a></p>
<p> 2.1.3.7. <a href="#requestedsignaturealgorithm">RequestedSignatureAlgorithm</a></p>
<p> 2.1.3.8. <a href="#signmessage">SignMessage</a></p>
<p> 2.1.3.8.1. <a href="#signmessage-element">SignMessage element</a></p>
<p> 2.1.3.8.2. <a href="#requesting-identity-provider-to-display-signmessage">Requesting Identity Provider to display SignMessage</a></p>
<p> 2.1.3.9. <a href="#certrequestproperties">CertRequestProperties</a></p>
<p> 2.1.3.9.1. <a href="#authncontextclassref">AuthnContextClassRef</a></p>
<p> 2.1.3.9.2. <a href="#requestedcertattributes">RequestedCertAttributes</a></p>
<p> 2.2. <a href="#sign-responses">Sign Responses</a></p>
<p> 2.2.1. <a href="#signature-on-sign-responses">Signature on sign responses</a></p>
<p> 2.2.2. <a href="#sign-response-status-information">Sign response status information</a></p>
<p> 2.2.3. <a href="#generated-signature">Generated signature</a></p>
<p> 2.2.4. <a href="#dss-extension">DSS Extension</a></p>
<p> 2.2.4.1. <a href="#version">Version</a></p>
<p> 2.2.4.2. <a href="#responsetime">ResponseTime</a></p>
<p> 2.2.4.3. <a href="#request">Request</a></p>
<p> 2.2.4.4. <a href="#signerassertioninfo">SignerAssertionInfo</a></p>
<p> 2.2.4.5. <a href="#signaturecertificatechain">SignatureCertificateChain</a></p>
</li>
<li><p><a href="#http-post-binding"><strong>HTTP POST binding</strong></a></p>
<p> 3.1. <a href="#message-exchange-model">Message exchange model</a></p>
<p> 3.1.1. <a href="#sign-request-xhtml-form">Sign request XHTML form</a></p>
<p> 3.1.2. <a href="#sign-response-xhtml-form">Sign Response XHTML form</a></p>
</li>
<li><p><a href="#references"><strong>References</strong></a></p>
<p> 4.1. <a href="#normative-references">Normative References</a></p>
<p> 4.2. <a href="#informative-references">Informative References</a></p>
</li>
<li><p><a href="#changes-between-versions"><strong>Changes between versions</strong></a></p>
</li>
</ol>
<p><a name="introduction"></a></p>
<h2 id="1.-introduction">1. Introduction</h2>
<p>This document specifies an implementation profile for exchange of sign
requests and responses using the OASIS DSS protocol [<a href="#dss">DSS</a>], enhanced by
the DSS Extensions for Federated Central Signing Services [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>Section 2 defines the sign request and response messages and section 3
defines the transport of these messages using HTTP POST.</p>
<p><a name="terminology"></a></p>
<h3 id="1.1.-terminology">1.1. Terminology</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Defined meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>User</strong></td>
<td>The entity requested to sign a document</td>
</tr>
<tr>
<td><strong>Requesting Service</strong></td>
<td>The service requesting the signature on a particular document by a particular user</td>
</tr>
<tr>
<td><strong>Signing Service</strong></td>
<td>A centralized service that manages the process to authenticate the user that has been requested to sign a document, and the process to obtain the user’s signature on the requested document.</td>
</tr>
</tbody>
</table>
<p><a name="requirement-key-words"></a></p>
<h3 id="1.2.-requirement-key-words">1.2. Requirement key words</h3>
<p>The key words <strong>MUST</strong>, <strong>MUST</strong> <strong>NOT</strong>, <strong>REQUIRED</strong>, <strong>SHALL</strong>,
<strong>SHALL</strong> <strong>NOT</strong>, <strong>SHOULD</strong>, <strong>SHOULD</strong> <strong>NOT</strong>, <strong>RECOMMENDED</strong>,
<strong>MAY</strong>, and <strong>OPTIONAL</strong> are to be interpreted as described in
[<a href="#rfc2119">RFC2119</a>].</p>
<p>These keywords are capitalized when used to unambiguously specify
requirements over protocol features and behavior that affect the
interoperability and security of implementations. When these words are
not capitalized, they are meant in their natural-language sense.</p>
<p><a name="name-space-references"></a></p>
<h3 id="1.3.-name-space-references">1.3. Name space references</h3>
<p>Conventional XML namespace prefixes are used throughout the listings in
this specification to stand for their respective namespaces as follows,
whether or not a namespace declaration is present in the example:</p>
<table>
<thead>
<tr>
<th>Prefix</th>
<th>XML Namespace</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>csig</td>
<td><code>http://id.elegnamnden.se/csig/1.1/dss-ext/ns</code></td>
<td>For the DSS extension namespace [<a href="#dss-ext">DSS-Ext</a>] (default namespace).</td>
</tr>
<tr>
<td>dss</td>
<td><code>urn:oasis:names:tc:dss:1.0:core:schema</code></td>
<td>The DSS core namespace [<a href="#dss">DSS</a>].</td>
</tr>
<tr>
<td>ds</td>
<td><code>http://www.w3.org/2000/09/xmldsig\#</code></td>
<td>The XML Signature Syntax and Processing specification [<a href="#xmlsig">XMLSig</a>] and its governing schema [<a href="#xmlsig-xsd">XMLSig-XSD</a>].</td>
</tr>
<tr>
<td>saml</td>
<td><code>urn:oasis:names:tc:SAML:2.0:assertion</code></td>
<td>The SAML V2.0 assertion namespace, defined in the schema [<a href="#saml-xsd">SAML-XSD</a>].</td>
</tr>
</tbody>
</table>
<hr>
<p><a name="identification"></a></p>
<h3 id="1.4.-identification">1.4. Identification</h3>
<p>The following URI identifier identifies this profile:</p>
<blockquote>
<p><strong><code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code></strong></p>
</blockquote>
<p><a name="structure"></a></p>
<h3 id="1.5.-structure">1.5. Structure</h3>
<p>This specification uses the following typographical conventions in text:
<code>&lt;EidElement&gt;</code>, <code>&lt;ns:ForeignElement&gt;</code>, <code>Attribute</code>, <strong>Datatype</strong>,
<code>OtherCode</code>.</p>
<p><a name="sign-request-and-response-messages"></a></p>
<h2 id="2.-sign-request-and-response-messages">2. Sign request and response messages</h2>
<p>This section defines a profile for sign requests and responses using the
OASIS DSS standard [<a href="#dss">DSS</a>] in combination with “DSS extensions for
Federated Central Signing Services” [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>In the following sections the OASIS DSS standard is referred to as “DSS”
and the DSS extensions are referred to as “DSS-Ext”.</p>
<p>Conformance with this implementation profile requires full conformance
with DSS and DSS-Ext. In case of conflict between DSS-Ext and DSS,
DSS-Ext is the normative one. In case of differences between this
implementation profile and DSS-Ext, this implementation profile is the
normative one.</p>
<p><a name="sign-requests"></a></p>
<h3 id="2.1.-sign-requests">2.1. Sign Requests</h3>
<p>Sign requests are carried in a <code>&lt;dss:SignRequest&gt;</code> element according to requirements and conditions of the following subsections.</p>
<p>The <code>&lt;dss:SignRequest&gt;</code> element MUST have a Profile attribute with the value <code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>, which specifies conformance to this implementation profile.</p>
<p>The <code>&lt;dss:SignRequest&gt;</code> element MUST have a <code>RequestID</code> attribute with a value that uniquely identifies this request. The <code>RequestID</code> value MUST be a random generated value with at least 128 bit entropy and a length of at least 20 bytes.</p>
<p><a name="signature-on-sign-requests"></a></p>
<h4 id="2.1.1.-signature-on-sign-requests">2.1.1. Signature on sign requests</h4>
<p>Sign requests MUST be signed. The signature MUST have a Same-Document URI-Reference (URI=””) to ensure that the signature covers the complete <code>&lt;dss:SignRequest&gt;</code> element.</p>
<p>The resulting <code>&lt;ds:Signature&gt;</code> element MUST be placed inside the <code>&lt;dss:OptionalInputs&gt;</code> element in accordance with section 5 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>The Signature Service MUST NOT process the sign request unless the signature of the sign request can be authenticated as originating from a legitimate Requesting Service.</p>
<p><a name="data-to-be-signed"></a></p>
<h4 id="2.1.2.-data-to-be-signed">2.1.2. Data to be signed</h4>
<p>A representation of the document to be signed MUST be provided in accordance with section 4.1 of DSS-Ext.</p>
<p>Data to be signed MUST be provided in a <code>&lt;SignTaskData&gt;</code>element.</p>
<p>The <code>&lt;SignTasks&gt;</code> element MAY contain one or more <code>&lt;SignTaskData&gt;</code> elements, representing one or more requested signatures.</p>
<p><a name="dss-extension"></a></p>
<h4 id="2.1.3.-dss-extension">2.1.3. DSS extension</h4>
<p>The <code>&lt;dss:OptionalInput&gt;</code> element of the sign request MUST contain a
<code>&lt;SignRequestExtension&gt;</code> element according to requirements and
conditions of the following subsections.</p>
<p><a name="version"></a></p>
<h5 id="2.1.3.1.-version">2.1.3.1. Version</h5>
<p>The version of the DSS-Ext specification MUST be version 1.1 (default).
The version attribute MUST either be absent (default value) or MUST
specify the value “1.1”.</p>
<p><a name="conditions"></a></p>
<h5 id="2.1.3.2.-conditions">2.1.3.2. Conditions</h5>
<p>A <code>&lt;saml:Conditions&gt;</code> element MUST be present. This element MUST NOT
contain any information in addition to what is defined in section 3.1 of
[<a href="#dss-ext">DSS-Ext</a>].</p>
<p><a name="signer"></a></p>
<h5 id="2.1.3.3.-signer">2.1.3.3. Signer</h5>
<p>The <code>&lt;Signer&gt;</code> element MUST contain at least the SAML attributes
that are necessary in order to uniquely identify the signer. The present
attributes MUST match the attributes that are provided for this signer
when authenticating the signer using the Identity Provider specified in
the <code>&lt;IdentityProvider&gt;</code> element.</p>
<p>The Signing Service MUST match all attribute values provided in the
<code>&lt;Signer&gt;</code> element with SAML attributes provided for this signer
subject in a valid assertion obtained from the specified Identity
Provider.</p>
<p>If any of the attributes specified in the <code>&lt;Signer&gt;</code> element cannot
be found or matched with a corresponding attribute value from an
obtained assertion from the specified Identity Provider, the Signing
Service MUST reject the sign request.</p>
<p><a name="identityprovider"></a></p>
<h5 id="2.1.3.4.-identityprovider">2.1.3.4. IdentityProvider</h5>
<p>This element MUST be present, specifying the SAML EntityID of the
Identity Provider that MUST be used to authenticate the signer. The
Signing Service MUST NOT generate the requested signature unless the
signer is successfully authenticated through this Identity Provider.</p>
<p><a name="sign-requester"></a></p>
<h5 id="2.1.3.5.-sign-requester">2.1.3.5. Sign Requester</h5>
<p>This element MUST be present, specifying the identity of the Requesting
Service in the form of its SAML EntityID.</p>
<p><a name="signservice"></a></p>
<h5 id="2.1.3.6-signservice">2.1.3.6 SignService</h5>
<p>This element MUST be present, specifying the SAML EntityID of the
Signing Service that is the target of this sign request.</p>
<p><a name="requestedsignaturealgorithm"></a></p>
<h5 id="2.1.3.7.-requestedsignaturealgorithm">2.1.3.7. RequestedSignatureAlgorithm</h5>
<p>This element MAY be present, specifying a URI that identifies a
signature algorithm that the Requesting Service prefers to be used when
generating the requested signature.</p>
<p>When this element is absent, the default signing algorithm is RSA with
SHA-256.</p>
<p><a name="signmessage"></a></p>
<h5 id="2.1.3.8.-signmessage">2.1.3.8. SignMessage</h5>
<p><a name="signmessage-element"></a></p>
<h6 id="2.1.3.8.1.-signmessage-element">2.1.3.8.1. SignMessage element</h6>
<p>This element MAY be present to provide information that the Identity
Provider MAY display for the user before obtaining the user’s consent to
sign. The message MAY be provided in clear text or in encrypted form.
The attribute <code>MustShow</code> MUST be set to <code>true</code> if the Identity Provider is
required to show this message to the user. When the message is provided
in encrypted form, the <code>DisplayEntity</code> attribute MUST include the EntityID
of the Identity Provider holding the private decryption key. The
encryption key included in the metadata of the identified Identity
Provider SHOULD be used to encrypt the message.</p>
<p>The message MUST be encoded using UTF-8 and MUST be using one of the
formats plain text, HTML or markdown. The appropriate MIME type must be
declared in the <code>MimeType</code> attribute.</p>
<p>For messages in HTML format, the message MUST NOT contain tags and
attributes for each tag other than those listed in the following table:</p>
<table>
<thead>
<tr>
<th>HTML Tags</th>
<th>Type</th>
<th>Allowed attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td>h1, h2, h3, h4</td>
<td>Headings</td>
<td>style</td>
</tr>
<tr>
<td>div, span, p</td>
<td>Section</td>
<td>style</td>
</tr>
<tr>
<td>table, tr, td</td>
<td>Table</td>
<td>style</td>
</tr>
<tr>
<td>b, strong</td>
<td>Highlight</td>
<td>style</td>
</tr>
<tr>
<td>i, u, br</td>
<td>Format</td>
<td>&nbsp;</td>
</tr>
<tr>
<td>ol, ul, li</td>
<td>List</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Allowed HTML entities for character replacement SHALL be restricted to
<code>amp</code>, <code>gt</code>, <code>lt</code>, <code>quot</code> and <code>nbsp</code> (in the form <code>&amp;entity-name;</code>).</p>
<p>HTML messages MUST NOT contain any URI references to data outside of the
message and MUST NOT contain any JavaScript in any form.</p>
<p><a name="requesting-identity-provider-to-display-signmessage"></a></p>
<h6 id="2.1.3.8.2.-requesting-identity-provider-to-display-signmessage">2.1.3.8.2. Requesting Identity Provider to display SignMessage</h6>
<p>The means through which the Service Provider requests the Identity
Provider to display a sign message is defined in the “Deployment Profile
for the Swedish eID Framework” [Eid-Profile] section 7.2.1.</p>
<p>In addition to these requirements the Signature Service MUST apply the
following process to determine which <code>AuthnContextClassRef</code> URI to include
in the <code>AuthnRequest</code> sent to the Identity Provider when authenticating
the user for signing:</p>
<p><img src="img/dssprof-sign-msg-flow.png"></img></p>
<p>The input data for the process is:</p>
<table>
<thead>
<tr>
<th>Input</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ClassRef</code></td>
<td>The <code>AuthnContextClassRef</code> specified in the sign request as <code>CertRequestProperties</code>.</td>
</tr>
<tr>
<td><code>SignMessage</code></td>
<td>The <code>SignMessage</code> element in the sign request.</td>
</tr>
<tr>
<td><code>MustShow</code></td>
<td>The <code>MustShow</code> attribute of the <code>SignMessage</code> element.</td>
</tr>
<tr>
<td><code>AuthnContextClassRef</code> URIs</td>
<td>URIs supported by the Identity Provider, retrieved from the Identity Provider&#39;s metadata.</td>
</tr>
</tbody>
</table>
<p>Functions and values:</p>
<table>
<thead>
<tr>
<th>Functions</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>getLoa</strong>(ClassRef)</td>
<td>Returns the Level of Assurance represented by a specified AuthnContextClassRef URI.</td>
</tr>
<tr>
<td><strong>ClassRef</strong>(LoA)</td>
<td>The default AuthnContextClassRef URI specified for a specified LoA with no requirements to display a sign message.</td>
</tr>
<tr>
<td><strong>ClassRef</strong>(LoA + SM)</td>
<td>The AuthnContextClassRef URI specified for a specified LoA with requirements to display a sign message.</td>
</tr>
<tr>
<td>Default LoA</td>
<td>The default Level of Assurance according to the governing policy.</td>
</tr>
</tbody>
</table>
<p><strong><em>Process steps:</em></strong></p>
<ol class="list">
<li><p>Determine requested LoA (Level of Assurance) by either:</p>
<ol class="list">
<li>Get the LoA from the <code>ClassRef</code> URI specified in the sign request, if present, or</li>
<li>if the <code>ClassRef</code> from the sign request is absent (NULL) then
 use the default LoA.</li>
</ol>
</li>
<li><p>If no <code>SignMessage</code> is present in the sign request:</p>
<ol class="list">
<li>Request <strong>ClassRef</strong>(LoA) as <code>RequestedAuthnContext</code> if supported by the Identity Provider.</li>
<li>Otherwise fail signing and return an error sign response, indicating a request failure (the requested LoA was inconsistent with the specified Identity Provider).</li>
<li>End.</li>
</ol>
</li>
<li><p>If the Identity Provider supports <strong>ClassRef</strong>(LoA + SM):</p>
<ol class="list">
<li>Include sign message in the <code>AuthnRequest</code> to the Identity Provider.</li>
<li>Request <strong>ClassRef</strong>(LoA + SM) as <code>RequestedAuthnContext</code>.</li>
<li>End.</li>
</ol>
</li>
<li><p>If <code>MustShow</code> = <code>true</code>:</p>
<ol class="list">
<li>Fail signing and return an error sign response, indicating a
request failure (a sign message included a requirement to be
displayed but the specified Identity Provider does not support
display of sign messages).</li>
<li>End.</li>
</ol>
</li>
<li><p>Proceed with normal authentication:</p>
<ol class="list">
<li>Include sign message in the <code>AuthnRequest</code> to the Identity
Provider (just in case the Identity Provider can make use of
this information anyway).</li>
<li>Request <strong>ClassRef</strong>(LoA) as <code>RequestedAuthnContext</code> if supported
by the Identity Provider.</li>
<li>Otherwise fail signing and return an error sign response,
indicating a request failure (the requested LoA was inconsistent
with the specified Identity Provider).</li>
<li>End.</li>
</ol>
</li>
</ol>
<p>Note: The process defined above requires that the <strong>ClassRef</strong>(LoA + SM)
MUST be used when the sign request includes a sign message and the
Identity Provider has declared that it supports display of sign
messages. This allows a requesting service to send a sign request with a
sign message with <code>MustShow</code> = <code>false</code> and still obtain proof of display of
sign message from those Identity Providers that do support display of
sign messages.</p>
<p><a name="certrequestproperties"></a></p>
<h5 id="2.1.3.9.-certrequestproperties">2.1.3.9. CertRequestProperties</h5>
<p>This element MAY be present to provide requested properties of generated
signature certificates according with section 3.1.1 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p><a name="authncontextclassref"></a></p>
<h6 id="2.1.3.9.1.-authncontextclassref">2.1.3.9.1. AuthnContextClassRef</h6>
<p>This element MAY be present to specify the Level of Assurance required
in order to issue the signing certificate. This element serves only to
determine the Level of Assurance required. See further the algorithm to
determine the <code>AuthnContextClassRef</code> URI specified as
<code>RequestedAuthnContext</code> in section 2.1.3.8.2.</p>
<p><a name="requestedcertattributes"></a></p>
<h6 id="2.1.3.9.2.-requestedcertattributes">2.1.3.9.2. RequestedCertAttributes</h6>
<p>This element MAY be present to specify any number of attributes that the
Requesting Service requires or requests to be included as a
representation of the subject in the signature certificate that is
generated with the requested signature.</p>
<p>The Signature Service MUST NOT generate the requested signature unless
it can obtain attribute values from an authoritative source for all
requested attributes that is marked as “required”. The Signature service
SHOULD attempt to provide all “requested” attributes.</p>
<p>The Signing Service MAY use an Attribute Authority as complementary
source to obtain requested attribute values, as long as the identity
assertion provided by the specified Identity Provider is sufficient to
uniquely identify the signer. The Sign Requester MAY provide one or more
SAML EntityID identifiers of Attribute Authorities in
<code>&lt;AttributeAuthority&gt;</code> elements, which could be used to obtain an
attribute value for the requested attribute.</p>
<p>It is left to local policy of the Signature Service whether it accepts
any <code>DefaultValue</code> attribute value for any requested attributes as being
provided by an authoritative source. If a <code>DefaultValue</code> is accepted as
authoritative, it MUST NOT conflict with any attributes received by the
specified Identity Provider or Attribute Authority when authenticating
the signer. If the requested attribute is provided by the Identity
Provider or any Attribute Authority used by the Signing Service, then
these values MUST be used over the <code>DefaultValue</code>.</p>
<p><a name="sign-responses"></a></p>
<h3 id="2.2.-sign-responses">2.2. Sign Responses</h3>
<p>Sign responses are carried in a <code>&lt;dss:SignResponse&gt;</code> element
according to requirements and conditions of the following subsections.</p>
<p>The <code>&lt;dss:SignResponse&gt;</code> element MUST have a Profile attribute with
the value <code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>, which
specifies conformance to this implementation profile.</p>
<p>The <code>&lt;dss:SignResponse&gt;</code> element MUST have a <code>RequestID</code> attribute
with a value that is identical to the sign request that is being
serviced through this sign response.</p>
<p><a name="signature-on-sign-responses"></a></p>
<h4 id="2.2.1.-signature-on-sign-responses">2.2.1. Signature on sign responses</h4>
<p>Sign responses MUST be signed. The signature MUST have a Same-Document
URI-Reference (URI=””) to ensure that the signature covers the complete
<code>&lt;dss:SignResponse&gt;</code> element.</p>
<p>The resulting <code>&lt;ds:Signature&gt;</code> element MUST be placed inside the
<code>&lt;dss:OptionalOutputs&gt;</code> element in accordance with section 5 of
[DSS-Ext].</p>
<p><a name="sign-response-status-information"></a></p>
<h4 id="2.2.2.-sign-response-status-information">2.2.2. Sign response status information</h4>
<p>Implementations of this specification MUST return a
<code>&lt;dss:ResultMajor&gt;</code> value and MAY return a <code>&lt;dss:ResultMinor&gt;</code>
value. Implementations of this specification are released from the
requirement to return any of the listed values of
<code>&lt;dss:ResultMinor&gt;</code>, specified in the DSS standard, when returning
the <code>&lt;dss:ResultMajor&gt;</code> value
<code>urn:oasis:names:tc:dss:1.0:resultmajor:Success</code>, since all the listed
<code>&lt;dss:ResultMinor&gt;</code> values relates to signature validation and not
signature creation.</p>
<p>With the exception above, the response values defined in section 2.6 of
the DSS standard, amended by status identifiers defined in section 3.1.7
of [<a href="#eid-registry">Eid-Registry</a>], SHOULD be used.</p>
<p><a name="generated-signature"></a></p>
<h4 id="2.2.3.-generated-signature">2.2.3. Generated signature</h4>
<p>The generated signature result data SHALL be provided in
<code>&lt;SignTaskData&gt;</code> element according to section 4.1.1 of [<a href="#dss-ext">DSS-Ext</a>].</p>
<p>One <code>&lt;SignTaskData&gt;</code> element shall be provided for each successfully
generated signature as a result of the corresponding request.</p>
<p><a name="dss-extension"></a></p>
<h4 id="2.2.4.-dss-extension">2.2.4. DSS Extension</h4>
<p>The <code>&lt;dss:OptionalInput&gt;</code> element of the sign response MUST contain
a <code>&lt;SignResponseExtension&gt;</code> element according to requirements and
conditions of the following subsections.</p>
<p><a name="version"></a></p>
<h5 id="2.2.4.1.-version">2.2.4.1. Version</h5>
<p>The version of the DSS-Ext specification MUST be version 1.1 (default).
The version attribute MUST either be absent (default value) or MUST
specify the value “1.1”.</p>
<p><a name="responsetime"></a></p>
<h5 id="2.2.4.2.-responsetime">2.2.4.2. ResponseTime</h5>
<p>The <code>&lt;ResponseTime&gt;</code> element MUST be present in the response.</p>
<p><a name="request"></a></p>
<h5 id="2.2.4.3.-request">2.2.4.3. Request</h5>
<p>The <code>&lt;Request&gt;</code> element MUST be present in all responses where a
corresponding request could be parsed and authenticated to originate
from a legitimate requester.</p>
<p><a name="signerassertioninfo"></a></p>
<h5 id="2.2.4.4.-signerassertioninfo">2.2.4.4. SignerAssertionInfo</h5>
<p>The <code>&lt;SignerAssertionInfo&gt;</code> element MUST be present if the signer
has been successfully authenticated using the specified Identity
Provider. The present <code>&lt;ContextInfo&gt;</code> child element MUST include an
<code>&lt;AssertionRef&gt;</code> child element. The <code>&lt;AssertionRef&gt;</code> child
element MUST contain the value of the <code>ID</code> attribute of the root element
of the SAML assertion used to authenticate the signer.</p>
<p><a name="signaturecertificatechain"></a></p>
<h5 id="2.2.4.5.-signaturecertificatechain">2.2.4.5. SignatureCertificateChain</h5>
<p>The <code>&lt;SignatureCertificateChain&gt;</code> element MUST be present if a
certificate was issued to the signer. This element MUST provide a
complete chain of certificate up to a self-signed root certificate.</p>
<p>All signature values according to section 2.2.3 MUST be verifiable using
the signer certificate provided in this element.</p>
<p><a name="http-post-binding"></a></p>
<h2 id="3.-http-post-binding">3. HTTP POST binding</h2>
<p>This section specifies the protocol binding
for transport of sign request and sign response using HTTP POST. This
protocol binding implements the message exchange model in section 3.1.</p>
<p>This process is technically equivalent to the procedures implemented by
SAML HTTP POST bindings [<a href="#saml2bind">SAML2Bind</a>], section 3.5.</p>
<p><a name="message-exchange-model"></a></p>
<h3 id="3.1.-message-exchange-model">3.1. Message exchange model</h3>
<p>Sign request and response messages are exchanged between the Requesting
Service and the Signing Service with the user acting as an intermediary
through a user agent (typically a web browser) according to the
following message flow:</p>
<p><img src="img/dssprof-msg-exch-model.png"></img></p>
<ol class="list">
<li><p>The user agent initiates the signing process by an HTTP request to
the Service Provider, for example caused by the user clicking on
some button on a web page.</p>
</li>
<li><p>The Service Provider responds to the user agent with an XHTML form,
containing a Base64 encoded sign request.</p>
</li>
<li><p>A JavaScript in the XHTML form causes the user agent to send the
sign request to the Signing Service using HTTP POST.</p>
</li>
<li><p>The user interacts with the Signing Service to complete the
requested signature.</p>
</li>
<li><p>The Signing Service responds to the user agent with an XHTML form,
containing a Base64 encoded sign response.</p>
</li>
<li><p>A JavaScript in the XHTML form causes the user agent to send the
sign response to the Service Provider using HTTP POST.</p>
</li>
<li><p>The Service Provider processes the sign response and a confirmation
or status message is returned to the user agent.</p>
</li>
</ol>
<p>The steps 1,4 and 7 are part of the service infrastructure and are
outside the scope of this HTTP POST binding specification.</p>
<p><a name="sign-request-xhtml-form"></a></p>
<h4 id="3.1.1.-sign-request-xhtml-form">3.1.1. Sign request XHTML form</h4>
<p>The sign request XHTML form SHALL have functional properties that are
equivalent to the following implementation example:</p>
<pre class="hljs"><code><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">'1.0'</span> encoding=<span class="hljs-string">'UTF-8'</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.1//EN' 'http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd'&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">'http://www.w3.org/1999/xhtml'</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">'en'</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">'document.forms[0].submit()'</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Note:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Since your browser does not support JavaScript,
    you must press the Continue button once to proceed.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">'https://eid2csig.konki.se/signrequest'</span> <span class="hljs-attr">method</span>=<span class="hljs-string">'post'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'Binding'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'POST/XML/1.0'</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'RelayState'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'56345145a482995d'</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'EidSignRequest'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'PD94bWw…WVzdD4='</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'submit'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'Continue'</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>The form’s action attribute specifies the URL to the Signing Service and
the form MUST have a method attribute with the value “post”.</p>
<p>The form MUST provide the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Binding</td>
<td>“POST/XML/1.0” Identifying implementation of this binding specification</td>
</tr>
<tr>
<td>RelayState</td>
<td>This parameter MUST contain the value of the RequestID attribute of the dss:SignRequest element that is present in the base64 encoded sign request.</td>
</tr>
<tr>
<td>EidSignRequest</td>
<td>Base64 encoded sign request.</td>
</tr>
</tbody>
</table>
<p><a name="sign-response-xhtml-form"></a></p>
<h5 id="3.1.2.-sign-response-xhtml-form">3.1.2. Sign Response XHTML form</h5>
<p>The sign response XHTML form SHALL have functional properties that are
equivalent to the following implementation example:</p>
<pre class="hljs"><code><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">'1.0'</span> encoding=<span class="hljs-string">'UTF-8'</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.1//EN' 'http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd'&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">'http://www.w3.org/1999/xhtml'</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">'en'</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">'document.forms[0].submit()'</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>Note:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> Since your browser does not support JavaScript,
    you must press the Continue button once to proceed.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">'https://sp.example.com/sigResponseHandler'</span> <span class="hljs-attr">method</span>=<span class="hljs-string">'post'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'Binding'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'POST/XML/1.0'</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'RelayState'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'56345145a482995d'</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'hidden'</span> <span class="hljs-attr">name</span>=<span class="hljs-string">' EidSignResponse'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'PD94bWw…WVzdD4='</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">'submit'</span> <span class="hljs-attr">value</span>=<span class="hljs-string">'Continue'</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></code></pre><p>The form’s action attribute specifies the URL to the requesting Service
Provider. This URL MUST specify a URL from the
<code>&lt;saml:AudienceRestriction&gt;</code> element that was provided in the
corresponding sign request. The form MUST have a method attribute with
the value “post”.</p>
<p>The form MUST provide the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Binding</td>
<td>“POST/XML/1.0” Identifying implementation of this binding specification</td>
</tr>
<tr>
<td>RelayState</td>
<td>This parameter MUST contain the value of the RequestID attribute of the <code>&lt;dss:SignResponse&gt;</code> element that is present in the base64 encoded sign request.</td>
</tr>
<tr>
<td>EidSignResponse</td>
<td>Base64 encoded sign response.</td>
</tr>
</tbody>
</table>
<p><a name="references"></a></p>
<h2 id="4.-references">4. References</h2>
<p><a name="normative-references"></a></p>
<h3 id="4.1.-normative-references">4.1. Normative References</h3>
<p><a name="eid-profile"></a><strong>[Eid-Profile]</strong></p>
<blockquote>
<p><a href="http://elegnamnden.github.io/technical-framework/latest/ELN-0602_-_Deployment_Profile_for_the_Swedish_eID_Framework.html">Deployment Profile for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="rfc2119"></a><strong>[RFC2119]</strong></p>
<blockquote>
<p><a href="http://www.ietf.org/rfc/rfc2119.txt">Bradner, S., Key words for use in RFCs to Indicate Requirement Levels, March 1997.</a></p>
</blockquote>
<p><a name="dss-ext"></a><strong>[DSS-Ext]</strong></p>
<blockquote>
<p><a href="http://elegnamnden.github.io/technical-framework/latest/ELN-0609_-_DSS_Extension_for_Federated_Signing_Services.html">DSS Extension for Federated Central Signing Services</a>.</p>
</blockquote>
<p><a name="dss"></a><strong>[DSS]</strong></p>
<blockquote>
<p><a href="https://docs.oasis-open.org/dss/v1.0/oasis-dss-core-spec-v1.0-os.html">OASIS Standard - Digital Signature Service Core Protocols, Elements, and Bindings Version 1.0, April 11, 2007</a>.</p>
</blockquote>
<p><a name="saml-xsd"></a><strong>[SAML-XSD]</strong></p>
<blockquote>
<p>S. Cantor et al., SAML assertions schema. OASIS SSTC, March 2005. Document ID: saml-schema-assertion-2.0. See <a href="http://www.oasisopen.org/committees/security/">http://www.oasisopen.org/committees/security/</a>.</p>
</blockquote>
<p><a name="xmlsig"></a><strong>[XMLSig]</strong></p>
<blockquote>
<p>D. Eastlake et al, XML-Signature Syntax and Processing, W3C Recommendation, February 2002.</p>
</blockquote>
<p><a name="xmlsig-xsd"></a><strong>[XMLSig-XSD]</strong></p>
<blockquote>
<p>XML Signature Schema. World Wide Web Consortium. See <a href="http://www.w3.org/TR/2000/CR-xmldsig-core-20001031/xmldsig-coreschema.xsd">http://www.w3.org/TR/2000/CR-xmldsig-core-20001031/xmldsig-coreschema.xsd</a>.</p>
</blockquote>
<p><a name="eid-registry"></a><strong>[Eid-Registry]</strong></p>
<blockquote>
<p><a href="http://elegnamnden.github.io/technical-framework/latest/ELN-0603_-_Registry_for_Identifiers.html">Registry for identifiers assigned by the Swedish e-identification
board</a>.</p>
</blockquote>
<p><a name="informative-references"></a></p>
<h3 id="4.2.-informative-references">4.2. Informative References</h3>
<p><a name="saml2bind"></a><strong>[SAML2Bind]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf">OASIS Standard, Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0, March 2005.</a></p>
</blockquote>
<p><a name="changes-between-versions"></a></p>
<h2 id="5.-changes-between-versions">5. Changes between versions</h2>
<p><strong>Changes between version 1.1 and version 1.2:</strong></p>
<ul class="list">
<li>In section 2.2.2, a reference to section 3.1.5 in [Eid-Registry] was changed to section 3.1.7.</li>
</ul>
<p><strong>Changes between version 1.0 and version 1.1:</strong></p>
<ul class="list">
<li><p>This profile now refers to version 1.1 of the “DSS Extensions for
Federated Central Signing Services” specification.</p>
</li>
<li><p>Changes were made to section 2.1.3.8, “SignMessage”, in order to
define usage of the <code>&lt;SignMessage&gt;</code> element.</p>
</li>
<li><p>The URI identifier that identifies this profile has been changed
from <code>http://id.elegnamnden.se/csig/1.0/eid2-dss/profile</code> to
<code>http://id.elegnamnden.se/csig/1.1/dss-ext/profile</code>.</p>
</li>
</ul>
    </article>
  </body>
</html>
