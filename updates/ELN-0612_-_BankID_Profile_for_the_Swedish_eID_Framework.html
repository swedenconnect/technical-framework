<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Implementation Profile for BankID Identity Providers within the Swedish eID Framework</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/eln-portrait.css" media="print" >
    <link type="text/css" rel="stylesheet" href="assets/css/eln-custom.css" media="print" >
  </head>
  <body>
    <article class="markdown-body"><p><img src="img/sweden-connect.png"></img></p>
<h1 id="implementation-profile-for-bankid-identity-providers-within-the-swedish-eid-framework">Implementation Profile for BankID Identity Providers within the Swedish eID Framework</h1>
<h3 id="version-1.2---2019-11-01---**draft-version**">Version 1.2 - 2019-11-01 - <strong>Draft version</strong></h3>
<p><em>ELN-0612-v1.2</em></p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol class="list">
<li><p><a href="#introduction"><strong>Introduction</strong></a></p>
<p> 1.1. <a href="#requirements-notation">Requirements Notation</a></p>
<p> 1.2. <a href="#references-to-saml-20-standards-and-profiles">References to SAML 2.0 Standards and Profiles</a></p>
<p> 1.3. <a href="#bankid-methods-and-applications">BankID Methods and Applications</a></p>
<p> 1.3.1. <a href="#representation-as-identity-providers">Representation as Identity Providers</a></p>
<p> 1.3.2. <a href="#recommended-limitations">Recommended Limitations</a></p>
<p> 1.4. <a href="#relying-party-configuration">Relying Party Configuration</a></p>
</li>
<li><p><a href="#attributes"><strong>Attributes</strong></a></p>
<p> 2.1. <a href="#attribute-transformation">Attribute Transformation</a></p>
<p> 2.1.1. <a href="#the-authcontextparams-attribute">The authContextParams Attribute</a></p>
</li>
<li><p><a href="#identity-provider-user-interface"><strong>Identity Provider User Interface</strong></a></p>
<p> 3.1. <a href="#general-requirements">General Requirements</a></p>
<p> 3.2. <a href="#automatic-start-of-bankid-client">Automatic Start of the BankID Client</a></p>
<p> 3.3. <a href="#mobile-bankid-on-another-device">Mobile BankID on another Device</a></p>
<p> 3.3.1. <a href="#user-experience-recommendations">User Experience Recommendations</a></p>
<p> 3.4. <a href="#cancelling-an-operation">Cancelling an Operation</a></p>
</li>
<li><p><a href="#authentication-requests"><strong>Authentication Requests</strong></a></p>
<p> 4.1. <a href="#binding-and-security-requirements">Binding and Security Requirements</a></p>
<p> 4.2. <a href="#authentication-for-signature">Authentication for Signature</a></p>
<p> 4.2.1. <a href="#input-to-bankid-signing">Input to BankID Signing</a></p>
<p> 4.2.1.1. <a href="#uservisibledata">userVisibleData - Signature Message</a></p>
<p> 4.2.1.2. <a href="#usernonvisibledata">userNonVisibleData</a></p>
<p> 4.2.2. <a href="#mobile-bankid-and-the-personnumber-attribute">Mobile BankID and the personNumber attribute</a></p>
</li>
<li><p><a href="#authentication-responses"><strong>Authentication Responses</strong></a></p>
<p> 5.1. <a href="#attribute-release-rules">Attribute Release Rules</a></p>
<p> 5.2. <a href="#error-responses">Error Responses</a></p>
</li>
<li><p><a href="#metadata"><strong>Metadata</strong></a></p>
<p> 6.1. <a href="#service-providers">Service Providers</a></p>
<p> 6.2. <a href="#identity-providers">Identity Providers</a></p>
<p> 6.3. <a href="#signature-services">Signature Services</a></p>
</li>
<li><p><a href="#references"><strong>References</strong></a></p>
</li>
<li><p><a href="#changes-between-versions"><strong>Changes between versions</strong></a></p>
</li>
</ol>
<hr>
<p><a name="introduction"></a></p>
<h2 id="1.-introduction">1. Introduction</h2>
<p>This profile defines how a SAML Identity Provider that offers authentication using the Swedish BankID technology should implement its services to be compliant with the Swedish eID Framework. It extends the &quot;Deployment Profile for the Swedish eID Framework&quot;, 
[<a href="#eid-profile">EidProfile</a>], with requirements and recommendations for Identity Providers offering BankID authentication and signature services.</p>
<p>The BankID interface for authentication and signature, the Relying Party Interface, is described in the &quot;BankID Relying Party Guidelines&quot;, [<a href="#bankid_spec">BankID_Spec</a>], specification. This specification MUST be fully implemented and supported by BankID Identity Providers compliant
with the Swedish eID Framework specifications.</p>
<p><a name="requirements-notation"></a></p>
<h3 id="1.1.-requirements-notation">1.1. Requirements Notation</h3>
<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; in this
document are to be interpreted as described in [<a href="#rfc2119">RFC2119</a>].</p>
<p>The use of SHOULD, SHOULD NOT, and RECOMMENDED reflects broad consensus
on deployment practices intended to foster both interoperability and
guarantees of security and confidentiality needed to satisfy the
requirements of many organizations that engage in the use of federated
identity. Deviating may limit a deployment&#39;s ability to technically
interoperate without additional negotiation, and should be undertaken
with caution.</p>
<p><a name="references-to-saml-20-standards-and-profiles"></a></p>
<h3 id="1.2.-references-to-saml-2.0-standards-and-profiles">1.2. References to SAML 2.0 Standards and Profiles</h3>
<p>When referring to elements from the SAML 2.0 core specification [<a href="#saml2core">SAML2Core</a>],
the following syntax is used:</p>
<ul class="list">
<li><p><code>&lt;saml2p:Element&gt;</code> – for elements from the SAML 2.0 Protocol
namespace.</p>
</li>
<li><p><code>&lt;saml2:Element&gt;</code> – for elements from the SAML 2.0 Assertion
namespace.</p>
</li>
</ul>
<p>When referring to elements from the SAML 2.0 metadata specifications,
the following syntax is used:</p>
<ul class="list">
<li><p><code>&lt;md:Element&gt;</code> – for elements defined in [<a href="#saml2meta">SAML2Meta</a>].</p>
</li>
<li><p><code>&lt;mdattr:Element&gt;</code> – for elements defined in [<a href="#saml2metaattr">SAML2MetaAttr</a>].</p>
</li>
</ul>
<p><a name="bankid-methods-and-applications"></a></p>
<h3 id="1.3.-bankid-methods-and-applications">1.3. BankID Methods and Applications</h3>
<p>There are three types of BankID:</p>
<ul class="list">
<li>Mobile BankID - End users use the &quot;BankID app&quot; on their mobile devices to authenticate or perform a signature. In these cases the user certificate is stored in the app and protected by a personal code.</li>
<li>BankID on file - End users use the desktop program &quot;BankID Security Application&quot; to authenticate or perform a signature. The user certificate is stored in a file on the computer and is protected by a user password.</li>
<li>BankID on card - End users make use of the same desktop program as described above, but the certificate is placed on a smart card. The user private key is unlocked using the PIN-pad on the smart card reader.</li>
</ul>
<p>The three above methods are all &quot;BankID&quot;, but historically, relying parties have made a difference between &quot;Mobile BankID&quot; and &quot;BankID&quot; (the original desktop version).</p>
<p><a name="representation-as-identity-providers"></a></p>
<h4 id="1.3.1.-representation-as-identity-providers">1.3.1. Representation as Identity Providers</h4>
<p>An actor offering BankID services can choose to use <strong>one</strong> BankID Identity Provider supporting all different BankID methods, or use <strong>several</strong> Identity Provider instances, one for each BankID method. </p>
<p>Services that support all methods within one Identity Provider instance usually displays a question to the user before authentication starts, where the user chooses between &quot;Using BankID on this device or another device&quot;. In an environment where a discovery service (or similar) is being used, this means that the user has to make two choices before the actual authentication process starts; first at the discovery service where the user selects &quot;BankID&quot; and then at the BankID Identity Provider where the user selects the type of BankID authentication to use.</p>
<p>It is RECOMMENDED that BankID services are split into separate Identity Providers for each supported BankID method. The reasons for this are the above argument about discovery, but also the fact that a Service Provider should be able to select which type of authentication that is required (for example, Mobile BankID may be accepted but not BankID on file). </p>
<p><a name="recommended-limitations"></a></p>
<h4 id="1.3.2.-recommended-limitations">1.3.2. Recommended Limitations</h4>
<p>The table below states the RECOMMENDED support and behaviour when support for BankID is implemented using separate Identity Providers (as recommended in section <a href="#representation-as-identity-providers">1.3.1</a> above). </p>
<table>
<thead>
<tr>
<th style="text-align:left">Identity Provider</th>
<th style="text-align:left">Desktop</th>
<th style="text-align:left">Mobile Phone</th>
<th style="text-align:left">Tablet</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Mobile BankID</td>
<td style="text-align:left">Start BankID on other device<sup>1</sup> (mobile phone or tablet).</td>
<td style="text-align:left">Start BankID on the same device<sup>2</sup>.</td>
<td style="text-align:left">Prompt the user to ask whether to start BankID on the tablet or on another device<sup>3</sup> (mobile phone).</td>
</tr>
<tr>
<td style="text-align:left">BankID on file (<em>or on card</em>)</td>
<td style="text-align:left">Start BankID on the same device<sup>4</sup>.</td>
<td style="text-align:left">Not supported<sup>5</sup>.</td>
<td style="text-align:left">Not supported<sup>5</sup>.</td>
</tr>
</tbody>
</table>
<ol class="list">
<li>The user initiates a BankID operation from his or hers desktop computer and selects to use Mobile BankID. In this case the Mobile BankID app is started on another device (since Mobile BankID does not exist on desktop computers).</li>
<li>The user initiates a BankID operation from his or hers mobile phone and selects to use Mobile BankID. In this case the BankID app is started on the same device. It is highly unlikely that a user uses one mobile phone to visit a service and wants to use his or hers BankID on another device.</li>
<li>The user initiates a BankID operation from his or hers tablet and selects to use Mobile BankID. In this case the recommendation is to prompt the user to ask whether the Mobile BankID app should be automatically started on the tablet, or if the user wishes to use BankID on another device (probably a mobile phone). The reason for this recommendation is that most users have a BankID on their mobile phones, but not necessarily on their tablets.</li>
<li>The user initiates a BankID operation from his or hers desktop computer and selects to use BankID on file. The BankID Security Application is started on the same computer. It is not a likely use case to use one computer to connect to the service and another one for BankID.</li>
<li>This case should not be supported. If the user selects &quot;BankID on file&quot; from a mobile phone or tablet,  the Identity Provider should display an error message stating that Mobile BankID should be used instead and post an error response back to the Service Provider.</li>
</ol>
<p>Note: Items 4 and 5 above also apply to BankID on card. A service MAY choose to implement BankID on file and BankID on card as separate Identity Providers or as one Identity Provider instance.</p>
<p>For Identity Providers implementing BankID support in <strong>one</strong> Identity Provider instance it is RECOMMENDED to make the assumption that the BankID app should be started on the same device if the user connects via a mobile phone. </p>
<p><a name="relying-party-configuration"></a></p>
<h3 id="1.4.-relying-party-configuration">1.4. Relying Party Configuration</h3>
<p>When a Relying Party uses the BankID Relying Party API directly in order to implement BankID services, it has a set of configuration settings to choose from (see section 14.5 of [<a href="#bankid_spec">BankID_Spec</a>]). Examples are:</p>
<ul class="list">
<li><p>Should fingerprints be allowed instead of the user entering his or hers security code?</p>
</li>
<li><p>Active certificate policies.</p>
</li>
<li><p>Smart card reader preferences.</p>
</li>
</ul>
<p>However, the services of a BankID Identity Provider are used by several parties within the federation and it is thus harder to maintain a per Service Provider configuration. Therefore, a BankID Identity Provider compliant with this profile SHOULD use the same configuration defaults as stated in section 14.5 of [<a href="#bankid_spec">BankID_Spec</a>]).</p>
<blockquote>
<p><strong>Note:</strong> It is of course allowed for a BankID Identity Provider to maintain specific Service Provider configurations, but this is outside of the scope for this profile, and there will be no specification support to accomplish this.</p>
</blockquote>
<p>Besides the above Relying Party configurations, the BankID API offers two different ways to initiate a BankID operation for the cases where the user agent and the BankID app is not on the same device.</p>
<ul class="list">
<li><p>A QR code is displayed in the UI and the user is prompted to scan this code using his or hers mobile device (see section 4 of [<a href="#bankid_spec">BankID_Spec</a>]).</p>
</li>
<li><p>The user is prompted for his or hers personal number.</p>
</li>
</ul>
<p>The QR code functionality is a relatively new feature that was introduced to provide protection from fraudsters that remotely attempts to persuade people to authenticate or sign using their mobile BankID:s. By prompting the user to scan a QR code the user agent and mobile device are tied to the same physical location, and these kinds of frauds are eliminated.</p>
<p>Due to large number of BankID users and the fear of changing a well established pattern, many BankID Relying Parties have not yet implemented the use of QR codes. It is a consideration of ease of use versus higher security, and different service providers may have different opinion regarding the feature.</p>
<p>A Service Provider making use of a BankID Identity Provider has the possibility to explicitly
request that QR codes, instead of user ID prompting, is used by the Identity Provider to
initiate BankID operations. This is performed by declaring the 
<code>http://id.swedenconnect.se/general-ec/1.0/secure-authenticator-binding</code> entity category
(see section 6.1 of [<a href="#eidentcat">EidEntCat</a>]) in the Service Provider metadata.</p>
<p>A BankID Identity Provider compliant with this profile SHOULD support the use of QR codes to
initialize BankID operations. </p>
<p>BankID Identity Providers that support the QR code feature MUST declare the 
<code>http://id.swedenconnect.se/general-ec/1.0/secure-authenticator-binding</code> entity
category in its metadata and MUST check the presence of this entity category from a 
requesting Service Provider&#39;s metadata when processing a request, and MUST prompt the 
user to scan a QR code instead of asking for the personal identity number if the entity 
category is present.</p>
<blockquote>
<p>See <a href="#metadata">section 6</a>, &quot;<a href="#metadata">Metadata</a>&quot;, for details how to declare the secure-authenticator-binding entity category.</p>
</blockquote>
<p><a name="attributes"></a></p>
<h2 id="2.-attributes">2. Attributes</h2>
<p>An BankID Identity Provider use the BankID Relying Party API, as described in [<a href="#bankid_spec">BankID_Spec</a>], to communicate with the BankID-server when providing its services to end users. When a BankID-operation has completed successfully, the Identity Provider (the BankID Relying Party) invokes the Collect-method (<code>/rp/v5/collect</code>) to obtain the result from the operation.</p>
<p>The table <a href="#attribute-transformation">below</a> contains attribute transformation mappings between attributes from a Collect-method response as described in section 14.2.5 of [<a href="#bankid_spec">BankID_Spec</a>] and attributes defined within the Swedish eID Framework as defined in [<a href="#eid-attributes">EidAttributes</a>].</p>
<p>An Identity Provider should not necessarily release all transformed attributes received from the BankID-server to the Service Provider. See further section <a href="#attribute-release-rules">5.1</a>, &quot;<a href="#attribute-release-rules">Attribute Release Rules</a>&quot;.</p>
<p><a name="attribute-transformation"></a></p>
<h3 id="2.1.-attribute-transformation">2.1. Attribute Transformation</h3>
<table>
<thead>
<tr>
<th style="text-align:left">BankID attribute</th>
<th style="text-align:left">SAML Attribute</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>orderRef</code></td>
<td style="text-align:left">transactionIdentifier<br /><code>urn:oid:1.2.752.201.3.2</code></td>
<td style="text-align:left">The BankID order reference received from a BankID Auth (<code>/rp/v5/auth</code>) or Sign (<code>rp/v5/sign</code>) method invocation. This parameter is supplied as an input parameter to the Collect-call and is the unique transaction identifier for the BankID-operation.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>user.personalNumber</code></td>
<td style="text-align:left">personalIdentityNumber<br /><code>urn:oid:1.2.752.29.4.13</code></td>
<td style="text-align:left">Swedish ”personnummer”. 12 digits without hyphen.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>user.givenName</code></td>
<td style="text-align:left">givenName<br /><code>urn:oid:2.5.4.42</code></td>
<td style="text-align:left">User&#39;s given name.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>user.surname</code></td>
<td style="text-align:left">sn<br /><code>urn:oid:2.5.4.4</code></td>
<td style="text-align:left">User&#39;s surname.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>user.name</code></td>
<td style="text-align:left">displayName<br /><code>urn:oid:2.16.840.1.113730.3.1.241</code></td>
<td style="text-align:left">User&#39;s given name and surname.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>cert.notBefore</code></td>
<td style="text-align:left"><em>bankidNotBefore</em> key in authContextParams<br /><code>urn:oid:1.2.752.201.3.3</code></td>
<td style="text-align:left">Start of validity of user&#39;s BankID.<br />No direct attribute mapping exists, but may be represented as key-value pair in authContextParams, where the key is <em>bankidNotBefore</em>, see <a href="#the-authcontextparams-attribute">2.1.1</a> below.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>cert.notAfter</code></td>
<td style="text-align:left"><em>bankidNotAfter</em> key in authContextParams<br /><code>urn:oid:1.2.752.201.3.3</code></td>
<td style="text-align:left">End of validity of user&#39;s BankID.<br />No direct attribute mapping exists, but may be represented as key-value pair in authContextParams, where the key is <em>bankidNotAfter</em>, see <a href="#the-authcontextparams-attribute">2.1.1</a> below.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>device.ipAddress</code></td>
<td style="text-align:left"><em>bankidUserAgentAddress</em> key in authContextParams<br /><code>urn:oid:1.2.752.201.3.3</code></td>
<td style="text-align:left">The IP-address of the user agent presented to the BankID server. In cases where a user uses BankID &quot;on another device&quot; this address may not be the same as the web user agent. No direct attribute mapping exists, but may be represented as key-value pair in authContextParams, where the key is <em>bankidUserAgentAddress</em>, see <a href="#the-authcontextparams-attribute">2.1.1</a> below.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>signature</code></td>
<td style="text-align:left">userSignature<br /><code>urn:oid:1.2.752.201.3.11</code></td>
<td style="text-align:left">The signature applied by the user as part of the authentication/signature process.</td>
</tr>
<tr>
<td style="text-align:left"><code>completionData.</code><br /><code>ocspResponse</code></td>
<td style="text-align:left">authServerSignature<br /><code>urn:oid:1.2.752.201.3.13</code></td>
<td style="text-align:left">The OCSP response signed by the BankID issuer that proves that the user BankID was checked for revocation.</td>
</tr>
</tbody>
</table>
<p><a name="the-authcontextparams-attribute"></a></p>
<h4 id="2.1.1.-the-authcontextparams-attribute">2.1.1. The authContextParams Attribute</h4>
<p>The <code>authContextParams</code> attribute, see section 3.2.1 of [<a href="#eid-attributes">EidAttributes</a>], is a general purpose attribute to be used when non-standardized authentication data is to be transfered in a SAML assertion. </p>
<p>The attribute is used by attribute providers to release data from an authentication process that has no attribute definition of its own. Thus, should the BankID attributes <code>completionData.cert.notBefore</code>, <code>completionData.cert.notAfter</code> and <code>completionData.device.ipAddress</code> be transformed and included into an assertion, they would have to be placed as key-value pairs of the <code>authContextParams</code> attribute as the example below.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">saml2:Attribute</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>    
                           <span class="hljs-attr">FriendlyName</span>=<span class="hljs-string">"authContextParams"</span>
                           <span class="hljs-attr">Name</span>=<span class="hljs-string">"urn:oid:1.2.752.201.3.3"</span>
                           <span class="hljs-attr">NameFormat</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:2.0:attrname-format:uri"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">saml2:AttributeValue</span> <span class="hljs-attr">xsi:type</span>=<span class="hljs-string">"xs:string"</span>&gt;</span>
    bankidNotBefore=2016-05-30T09%3A30%3A10Z;bankidNotAfter=2018-05-30T09%3A30%3A10Z;bankidUserAgentAddress=85.229.202.232
  <span class="hljs-tag">&lt;/<span class="hljs-name">saml2:AttributeValue</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">saml2:Attribute</span>&gt;</span></code></pre><p>The example above represents the following BankID attributes and values:</p>
<ul class="list">
<li><code>completionData.cert.notBefore</code> = 2016-05-30T09-30-10Z</li>
<li><code>completionData.cert.notAfter</code> = 2018-05-30T09-30-10Z</li>
<li><code>completionData.device.ipAddress</code> = 85.229.202.232</li>
</ul>
<blockquote>
<p>The format for the notBefore and notAfter attributes should be the representation as given by the XML type <code>xs:dateTime</code>.</p>
</blockquote>
<p><a name="identity-provider-user-interface"></a></p>
<h2 id="3.-identity-provider-user-interface">3. Identity Provider User Interface</h2>
<p>This profile does not state any requirements on how the user interface for an Identity Provider implementing BankID services should be implemented other than the statements listed in the sub sections below.</p>
<p><a name="general-requirements"></a></p>
<h3 id="3.1.-general-requirements">3.1. General Requirements</h3>
<p>The user interface for a BankID Identity Provider SHOULD use the recommended user and error messages as defined in sections 6, &quot;Recommended User Messages&quot;, and 11, &quot;Recommended Terminology&quot;, of [<a href="#bankid_spec">BankID_Spec</a>].</p>
<p>The user interface for a BankID Identity Provider MUST display information about the Service Provider that sent the request. It is RECOMMENDED that this information is obtained from the <code>&lt;mdui:UIInfo&gt;</code> element from the Service Provider&#39;s metadata entry.</p>
<p>It MUST be clear to the user whether an authentication or a signature process is ongoing. </p>
<p>When an error occurs during an authentication or signature operation, the Identity Provider MUST display an error message that can be easily understood by the end user, and offer the possibility to acknowledge the error so that an error response may be posted back to the requesting Service Provider (as specified in section 6.4, &quot;Error Responses&quot;, of [<a href="#eid-profile">EidProfile</a>]).</p>
<p><a name="automatic-start-of-bankid-client"></a></p>
<h3 id="3.2.-automatic-start-of-the-bankid-client">3.2. Automatic Start of the BankID Client</h3>
<p>When an operation is initiated where the BankID client (app or desktop program) is on the same device as the user agent (web browser) the Identity Provider SHOULD attempt to &quot;auto start&quot; the BankID client as described in [<a href="#bankid_spec">BankID_Spec</a>].  </p>
<p>For the above cases where the BankID client is automatically started from the Identity Provider, the Identity Provider user interface SHOULD NOT ask for the user&#39;s personal identity number. This information is available in the &quot;BankID app&quot; or &quot;BankID Security Application&quot;.</p>
<p>Auto starting the BankID app from a mobile device requires the built-in web browser to be used to guarantee full support, see section 3.1 of [<a href="#bankid_spec">BankID_Spec</a>]. If the Identity Provider detects that the user is not using the platform&#39;s default browser it SHOULD prompt for the personal identity number and ask the user to manually start the BankID app (and switch back to the browser after the BankID operation).</p>
<blockquote>
<p><strong>Note:</strong> As an alternative to the above requirement the Identity Provider may display a button with an autostart link that starts the BankID app when clicked. The personal identity number will not be needed and the user will not have to start the app manually. </p>
<p>However, on iOS this will not work if an embedded browser is running within an app, since apps that are started by apps need to be whitelisted. Another thing to take into account is that the user still has to switch back from the BankID app to the browser, and that may not be obvious for the user (since the app was started automatically). </p>
<p>The recommendation is to abstain from using autostart links/buttons.</p>
</blockquote>
<p><a name="mobile-bankid-on-another-device"></a></p>
<h3 id="3.3.-mobile-bankid-on-another-device">3.3. Mobile BankID on another Device</h3>
<p>If the user agent (web browser) and the BankID app is not on the same device, a BankID Identity 
Provider that supports the BankID QR code feature MUST check for the presence of the 
<code>http://id.swedenconnect.se/general-ec/1.0/secure-authenticator-binding</code> entity category
in a requesting Service Provider&#39;s metadata entry. If the Service Provider has declared this entity category, the BankID Identity Provider MUST display a generated QR code for the user and 
MUST NOT prompt the user for the personal identity number.</p>
<blockquote>
<p>Note: If the <code>secure-authenticator-binding</code> entity category is present in the Service Provider 
metadata entry <strong>and</strong> a <code>&lt;psc:PrincipalSelection&gt;</code> extension containing a personal identity number 
is included in the authentication request from the Service Provider, the BankID Identity Provider 
SHOULD include this number in the BankID operation (<code>auth</code> or <code>sign</code>) along with the BankID
requirement parameter <code>autoStartTokenRequired=true</code> when initializing the BankID operation 
(see chapter 4 in [<a href="#bankid_spec">BankID_Spec</a>]). A generated QR code MUST still be displayed 
by the BankID Identity Provider, but by providing the personal identity number in the initializing BankID call the session will be bound not only to the BankID app that is used to scan the QR code but also to a specific user. If a user with a different personal identity number scans the QR code the operation will fail.</p>
</blockquote>
<p>If the <code>secure-authenticator-binding</code> entity category is not declared by the requesting Service
Provider, the Identity Provider needs to prompt the user for his or hers personal identity number (personnummer) in order to initiate a BankID operation. </p>
<p>Before prompting the user the Identity Provider SHOULD check if the current authentication request contains a <code>&lt;psc:PrincipalSelection&gt;</code> extension holding a personal identity number attribute value. </p>
<p>If the personal identity number is present in the <code>&lt;psc:PrincipalSelection&gt;</code> extension and the current operation is an &quot;authentication for signature&quot; operation (see <a href="#authentication-for-signature">section 4.2 below</a>), the Identity Provider MUST NOT prompt the user for the personal identity number, but use the value received in the request to initiate the signature operation.</p>
<p>If the current operation is an &quot;ordinary&quot; authentication and the personal identity number is received in the request, the Identity Provider MAY use this value to pre-fill the personal identity number in the prompt dialogue to make the user experience smooth, but it SHOULD NOT use it to initiate the BankID operation without user interaction. </p>
<blockquote>
<p>Note: Until the <code>&lt;psc:PrincipalSelection&gt;</code> extension is widely used the Identity Provider MAY save the personal identity number in the user&#39;s web browser session storage (in a session cookie or more preferably using the HTML5 sessionStorage object). That way the Identity Provider can avoid prompting the user for the personal identity number for signature operations even if the requesting Signature Service does not support the <code>&lt;psc:PrincipalSelection&gt;</code> extension.</p>
</blockquote>
<p>See also section <a href="#mobile-bankid-and-the-personnumber-attribute">4.2.2</a>, &quot;<a href="#mobile-bankid-and-the-personnumber-attribute">Mobile BankID and the personNumber attribute</a>&quot;.</p>
<p><a name="user-experience-recommendations"></a></p>
<h4 id="3.3.1.-user-experience-recommendations">3.3.1. User Experience Recommendations</h4>
<p>In a scenario where the user first logs in to a service, and later performs a signature, care should be taken to the user experience versus security. The user will probably think is disturbing to have to scan a QR code for every signature he or she performs within the logged in session. If the service can protect against the remote fraudster threat by using QR code for login, and if the <code>&lt;psc:PrincipalSelection&gt;</code> extension preventing personal identity number prompting is used for subsequent signatures, we probably have found the safest and most user friendly process. </p>
<p>This could be accomplished by declaring the <code>secure-authenticator-binding</code> entity category for the Service Provider responsible of user login, but not declaring it for the service&#39;s Signature Service. Instead the Signature Service makes sure to always include the <code>&lt;psc:PrincipalSelection&gt;</code> extension in authentication requests sent.</p>
<p>Note: An Identity Provider processing a request from a signature service can derive the QR versus prompting for personal identity number setting for the corresponding &quot;login service&quot; if the <code>RequesterID</code> element is present in the authentication request. This element holds the entityID for the login service that initiated the signature operation.</p>
<p><a name="cancelling-an-operation"></a></p>
<h3 id="3.4.-cancelling-an-operation">3.4. Cancelling an Operation</h3>
<p>A BankID Identity Provider MUST include a Cancel-button in the user interface enabling the possibility for the user to cancel the BankID operation. </p>
<p>If the use clicks the Cancel-button after a BankID-operation has been started<sup>1</sup> the Identity Provider MUST invoke the BankID-operation <code>/rp/v5/cancel</code>. Failure to do so may lead to a dangling BankID session that needs to time out before the user can use BankID again.</p>
<blockquote>
<p>[1]: Meaning that <code>/rp/v5/auth</code> or <code>/rp/v5/sign</code> has been called for the transaction.</p>
</blockquote>
<p><a name="authentication-requests"></a></p>
<h2 id="4.-authentication-requests">4. Authentication Requests</h2>
<p><a name="binding-and-security-requirements"></a></p>
<h3 id="4.1.-binding-and-security-requirements">4.1. Binding and Security Requirements</h3>
<p>An Identity Provider conformant with this profile MUST require <code>&lt;saml2p:AuthnRequest&gt;</code> messages to be signed (by indicating this in its metadata, see section <a href="#metadata">6</a>, &quot;<a href="#metadata">Metadata</a>&quot;). Thus, the Identity Provider MUST not accept messages that are not signed, or where the verification of the signature fails. In these cases the Identity Provider MUST respond with an error.</p>
<p><a name="authentication-for-signature"></a></p>
<h3 id="4.2.-authentication-for-signature">4.2. Authentication for Signature</h3>
<p>An Identity Provider conforming to the Swedish eID Framework is obliged to handle requests received from Signature Services as described in section 7, “Authentication for Signature”, of [<a href="#eid-profile">EidProfile</a>]. This section further specifies how a BankID Identity Provider should support “authentication for signature”.</p>
<p>A BankID Identity Provider that receives an <code>&lt;saml2p:AuthnRequest&gt;</code> message from a Signature Service MUST initiate a BankID <strong>signature</strong> operation. It MUST NOT initiate a BankID authentication operation for several reasons: </p>
<ul class="list">
<li>the user interface in the BankID client (app or Desktop program) during authentication indicates that the user is logging on (and not signing which is the case when a request from a Signature Service is being processed), </li>
<li>the user expects to be displayed a text describing what he or she is signing,</li>
<li>and most importantly, BankID is PKI-based and has support for signing using a non-repudiation key, so there is no reason not to use this function.</li>
</ul>
<p>The BankID client (app or desktop program) comprises a text box in which the signature message is displayed for the user. A BankID Identity Provider MUST NOT display the signature message in any other way than in this text box. How the signature message is assigned is specified below.</p>
<p>If the BankID Identity Provider prompts the user for his or hers personal identity number in order to initialize
the BankID signature operation, the Identity Provider MUST honour the requirement that ensures that a sign message is only displayed to the intended principal, see section 7.2.1 in [<a href="#eid-profile">EidProfile</a>].</p>
<p><a name="input-to-bankid-signing"></a></p>
<h4 id="4.2.1.-input-to-bankid-signing">4.2.1. Input to BankID Signing</h4>
<p>An Identity Provider that processes an <code>&lt;saml2p:AuthnRequest&gt;</code> from a Signature Service is not given the actual data that is being signed by the user via the Signature Service. However, in order to invoke the BankID signature function, the Identity Provider must supply the BankID-server with data to be signed. This section specifies the input to the BankID signature operation.</p>
<p>The &quot;To-be-signed&quot; data that is passed as input the the BankID Sign-method (<code>/rp/v5/sign</code>) is a combination of the data from the <code>userVisibleData</code> and <code>userNonVisibleData</code> parameters (section 14.1.2 of [<a href="#bankid_spec">BankID_Spec</a>]).</p>
<p><a name="uservisibledata"></a></p>
<h5 id="4.2.1.1.-uservisibledata---signature-message">4.2.1.1. userVisibleData - Signature Message</h5>
<p>The Sign-method parameter <code>userVisibleData</code> holds data that will be signed by the user but it is also displayed in the BankID application text box.</p>
<p>If the <code>&lt;saml2p:AuthnRequest&gt;</code> message contains a <code>SignMessage</code> extension, the contents of this message MUST be assigned to the <code>userVisibleData</code> parameter (after necessary encoding).</p>
<p>A BankID Identity Provider MUST only process <code>SignMessage</code> elements having their <code>MimeType</code> attribute set to <code>text</code><sup>1</sup> . For any other values (<code>text/html</code> or <code>text/markdown</code>), the Identity Provider MUST respond with an error.</p>
<p>If the <code>&lt;saml2p:AuthnRequest&gt;</code> message does not contain a <code>SignMessage</code> extension, the Identity Provider MUST assign a sensible default signature message to the <code>userVisibleData</code> parameter. How this message is constructed is the responsibility of the Identity Provider, but it must be obvious for the user who is the requesting party, i.e., the Service Provider that has ordered the signature operation<sup>2</sup>.</p>
<blockquote>
<p>[1]: If the <code>MimeType</code> attribute is not set, <code>text</code> is the default value.</p>
<p>[2]: For this purpose, the <code>&lt;mdui:DisplayName&gt;</code> element of the Signature Service’s metadata entry, is a good and generic choice.  </p>
</blockquote>
<p><a name="usernonvisibledata"></a></p>
<h5 id="4.2.1.2.-usernonvisibledata">4.2.1.2. userNonVisibleData</h5>
<p>In order to produce a BankID signature that contains a binding to the <code>&lt;saml2p:AuthnRequest&gt;</code> message that initiated this signature, a BankID Identity Provider compliant to this profile MUST assign the  <code>userNonVisibleData</code> parameter with data that uniquely binds the signature to the <code>&lt;saml2p:AuthnRequest&gt;</code> message.</p>
<p>It is RECOMMENDED that the following function is used to produce this unique binding:</p>
<pre class="hljs"><code>Base64Encode(<span class="hljs-string">"entityID="</span> + URLEncode(<span class="hljs-name">&lt;entityID</span> of SP&gt;) + <span class="hljs-string">";"</span> + <span class="hljs-string">"authnRequestID="</span> + URLEncode(<span class="hljs-name">&lt;ID</span> of AuthnRequest&gt;))</code></pre><p><a name="mobile-bankid-and-the-personnumber-attribute"></a></p>
<h4 id="4.2.2.-mobile-bankid-and-the-personnumber-attribute">4.2.2. Mobile BankID and the personNumber attribute</h4>
<p>When Mobile BankID is being used to sign data and the user has initiated the signature operation against the Signature Service from another device (desktop och tablet), and the BankID QR code functionality is not being used, the <code>personNumber</code> parameter must be assigned in the BankID Sign-call.</p>
<p>Preferably this information was received in the <code>&lt;psc:PrincipalSelection&gt;</code> of the <code>&lt;saml2p:AuthnRequest&gt;</code> as described in section <a href="#mobile-bankid-on-another-device">3.3</a>, &quot;<a href="#mobile-bankid-on-another-device">Mobile BankID on another Device</a>&quot;. </p>
<p>Identity Providers wanting to support Signature Services that do not include the <code>&lt;psc:PrincipalSelection&gt;</code> extension MAY store the personal identity number in the user&#39;s web browser session storage during authentication, and use it during signature<sup>1</sup>, see section <a href="#mobile-bankid-on-another-device">3.3</a> above.</p>
<blockquote>
<p>[1]: Almost all use cases where a user signs data is preceded by a login (authentication).</p>
</blockquote>
<p><a name="authentication-responses"></a></p>
<h2 id="5.-authentication-responses">5. Authentication Responses</h2>
<p><a name="attribute-release-rules"></a></p>
<h3 id="5.1.-attribute-release-rules">5.1. Attribute Release Rules</h3>
<p>Section <a href="#attribute-transformation">2.1</a>, &quot;<a href="#attribute-transformation">Attribute Transformation</a>&quot;, specifies how BankID attributes should be transformed into SAML attributes defined in [<a href="#eid-attributes">EidAttributes</a>]. However, it does not specify the attribute release rules stating which attributes that are to be released based on a particular request.</p>
<p>A BankID Identity Provider compliant to the Swedish eID Framework MUST honor the attribute release rules specified in section 6.2.1, &quot;Attribute Release Rules&quot;, of [<a href="#eid-profile">EidProfile</a>]. This section further extends these rules with the following:</p>
<ul class="list">
<li>A BankID Identity Provider SHOULD include the <code>transactionIdentifier</code>-attribute (a mapping of the BankID <code>orderRef</code>-attribute) in the <code>&lt;saml2:AttributeStatement&gt;</code> element independently of which attribute set that is requested. This attribute links the BankID operation to the assertion.</li>
<li>It is RECOMMENDED that a BankID Identity Provider includes the <code>userSignature</code>-attribute (containing the BankID signature) in the <code>&lt;saml2:AttributeStatement&gt;</code> element when a BankID signature operation has been performed.</li>
<li>Unless explicitly required<sup>1</sup> by the Service Provider the Identity Provider SHOULD NOT release any other attributes than those specified by the current attribute set(s)<sup>2</sup>.</li>
</ul>
<blockquote>
<p>[1]: A Service Provider explicitly requests attributes by declaring them as requested attributes in the <code>&lt;md:AttributeConsumingService&gt;</code> element of the Service Provider&#39;s metadata entry. See section <a href="#service-providers">6.1</a>.</p>
<p>[2]: Based on the service entity categories that a Service Provider has declared in its metadata, an Identity Provider derives which attribute sets to apply during attribute release.</p>
</blockquote>
<p><a name="error-responses"></a></p>
<h3 id="5.2.-error-responses">5.2. Error Responses</h3>
<p>A BankID Identity Provider MUST map errors received from the underlying BankID-server into SAML error response messages where the top level status code is either:</p>
<ul class="list">
<li><code>urn:oasis:names:tc:SAML:2.0:status:Requester</code> - for errors that are due to authentication or signature failures or faults due to an error on the part of the Service Provider,</li>
<li><code>urn:oasis:names:tc:SAML:2.0:status:Responder</code> - for errors that are due to an internal, or technical, error in the BankID-server or Identity Provider.</li>
</ul>
<p>Before a <code>&lt;saml2p:Response&gt;</code> message is posted back to the Service Provider the Identity Provider MUST display a relevant error message to the user.</p>
<p>It is RECOMMENDED that authentication/signature errors and failures to start the BankID client are represented using the second level status code <code>urn:oasis:names:tc:SAML:2.0:status:AuthnFailed</code>.</p>
<p>If the user cancels a BankID operation, either by clicking the Cancel-button in the Identity Provider user interface or the Cancel-button in the BankID app/Security Application, the Identity Provider SHOULD respond with a <code>&lt;saml2p:Response&gt;</code> message where the second level status code is <code>http://id.elegnamnden.se/status/1.0/cancel</code>.</p>
<p>In cases where the Identity Provider receives the BankID error code <code>ALREADY_IN_PROGRESS</code> in response to an Auth- or Sign-call the Identity Provider MAY display a warning to the user that someone may have initiated a BankID operation using their personal identity number<sup>1</sup>. If this warning is displayed, it is RECOMMENDED that the second level status code <code>http://id.elegnamnden.se/status/1.0/possibleFraud</code> is included in the error response message posted back to the Service Provider.</p>
<blockquote>
<p>[1]: There have been reports where fraudsters remotely try to convince people of using their Mobile BankID to log in to a service. In these cases, the fraudster initiates a BankID authentication prior to the person he tries to trick into logging in to the service, and is waiting for the user to enter his or hers personal code, thus authenticating the fraudsters session. </p>
</blockquote>
<p><a name="metadata"></a></p>
<h2 id="6.-metadata">6. Metadata</h2>
<p>This section extends section 2 of [<a href="#eid-profile">EidProfile</a>] with requirements specific for BankID.</p>
<p><a name="service-providers"></a></p>
<h3 id="6.1.-service-providers">6.1. Service Providers</h3>
<p>As stated in section <a href="#attribute-release-rules">5.1</a>, &quot;<a href="#attribute-release-rules">Attribute Release Rules</a>&quot;, a Service Provider may request additional attributes, other than those implicitly requested via the use of service entity categories, by declaring requested attributes under the <code>&lt;md:AttributeConsumingService&gt;</code> element.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">md:AttributeConsumingService</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">isDefault</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:2.0:metadata"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:ServiceName</span> <span class="hljs-attr">xmlns:xml</span>=<span class="hljs-string">"http://www.w3.org/XML/1998/namespace"</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">"sv"</span>&gt;</span>E-myndigheten<span class="hljs-tag">&lt;/<span class="hljs-name">md:ServiceName</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:ServiceName</span> <span class="hljs-attr">xmlns:xml</span>=<span class="hljs-string">"http://www.w3.org/XML/1998/namespace"</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">"en"</span>&gt;</span>The e-Authority<span class="hljs-tag">&lt;/<span class="hljs-name">md:ServiceName</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">md:RequestedAttribute</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"urn:oid:1.2.752.201.3.2"</span> <span class="hljs-attr">isRequired</span>=<span class="hljs-string">"false"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:RequestedAttribute</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"urn:oid:1.2.752.201.3.13"</span> <span class="hljs-attr">isRequired</span>=<span class="hljs-string">"false"</span>/&gt;</span>      
<span class="hljs-tag">&lt;/<span class="hljs-name">md:AttributeConsumingService</span>&gt;</span></code></pre><p><em>Example of how a Service Provider declares that it wishes to receive the transactionIdentifier and authServerSignature attributes in assertions.</em></p>
<p>A Service Provider requesting an attribute that is not supported by all Identity Providers that it may communicate with MUST NOT set the <code>isRequired</code> attribute of the <code>&lt;md:RequestedAttribute&gt;</code> element to <code>true</code>.</p>
<p>It is RECOMMENDED that Service Providers communicating with BankID Identity Providers include the <code>transactionIdentifier</code> attribute as a requested attribute.</p>
<p>As described in section <a href="#relying-party-configuration">1.4</a>, &quot;<a href="&quot;#relying-party-configuration&quot;">Relying Party Configuration</a>, a Service Provider may declare an entity category telling the BankID Identity Provider that it wishes QR codes to be used instead of prompting for the user personal identity number.</p>
<pre class="hljs"><code>&lt;mdattr:EntityAttributes xmln<span class="hljs-variable">s:mdattr</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:metadata:attribute"</span>&gt;
  &lt;sam<span class="hljs-variable">l:Attribute</span> Name=<span class="hljs-string">"http://macedir.org/entity-category"</span> 
                  NameFormat=<span class="hljs-string">"urn:oasis:names:tc:SAML:2.0:attrname-format:uri"</span>&gt;
    &lt;sam<span class="hljs-variable">l:AttributeValue</span> xsi:<span class="hljs-built_in">type</span>=<span class="hljs-string">"xs:string"</span>&gt;
      http://id.swedenconnect.<span class="hljs-keyword">se</span>/general-<span class="hljs-keyword">ec</span>/<span class="hljs-number">1.0</span>/secure-authenticator-binding
    &lt;/sam<span class="hljs-variable">l:AttributeValue</span>&gt;
    ...
  &lt;/sam<span class="hljs-variable">l:Attribute</span>&gt;
&lt;/mdattr:EntityAttributes&gt;</code></pre><p><em>Example of how a Service Provider declares the secure authenticator binding entity category. This means, for a BankID Identity Provider, that QR codes should be used to initiate BankID operations.</em></p>
<p><a name="identity-providers"></a></p>
<h3 id="6.2.-identity-providers">6.2. Identity Providers</h3>
<p>A BankID Identity Provider MUST require authentication request messages to be signed. This is indicated by assigning the <code>WantAuthnRequestsSigned</code> attribute of the <code>&lt;md:IDPSSPDescriptor&gt;</code> element to a value of <code>true</code>. </p>
<p>A BankID Identity Provider SHOULD declare the <code>&lt;psc:RequestedPrincipalSelection&gt;</code> element containing the attribute name for personalIdentityNumber (<code>urn:oid:1.2.752.29.4.13</code>) and include it in its metadata entry as described in section 2.1.3 of [<a href="#eid-profile">EidProfile</a>]. </p>
<p>Using this extension the Identity Provider announces that the requestor should send the personal identity number in the authentication request if this is known to the requestor. In this way, the Identity Provider does not have to prompt the user for the personal identity number for the use cases where this is required.</p>
<pre class="hljs"><code>...
<span class="hljs-tag">&lt;<span class="hljs-name">md:IDPSSODescriptor</span> <span class="hljs-attr">WantAuthnRequestsSigned</span>=<span class="hljs-string">"true"</span>
     <span class="hljs-attr">protocolSupportEnumeration</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:2.0:protocol"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:Extensions</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mdui:UIInfo</span> <span class="hljs-attr">xmlns:mdui</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:metadata:ui"</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">mdui:UIInfo</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">psc:RequestedPrincipalSelection</span> 
         <span class="hljs-attr">xmlns:psc</span>=<span class="hljs-string">"http://id.swedenconnect.se/authn/1.0/principal-selection/ns"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">psc:MatchValue</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"urn:oid:1.2.752.29.4.13"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">psc:RequestedPrincipalSelection</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">md:Extensions</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:KeyDescriptor</span> <span class="hljs-attr">use</span>=<span class="hljs-string">"signing"</span>&gt;</span>
    ...</code></pre><p><em>Example of how the Identity Provider declares the <code>RequestedPrincipalSelection</code> extension in its metadata.</em></p>
<p>A BankID Identity Provider supporting the BankID QR code feature MUST declare this in its metadata using
the <code>http://id.swedenconnect.se/general-ec/1.0/secure-authenticator-binding</code> entity category.</p>
<p><a name="signature-services"></a></p>
<h3 id="6.3.-signature-services">6.3. Signature Services</h3>
<p>It is RECOMMENDED that a Signature Service explicitly requires release of the <code>userSignature</code> attribute (<code>urn:oid:1.2.752.201.3.11</code>) in assertions. The reason for this is that the BankID-signature may then be part of the assertion that is included in the resulting signature created by the Signature Service giving a non-repudiation proof of the BankID signature process.</p>
<pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">md:AttributeConsumingService</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">isDefault</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"urn:oasis:names:tc:SAML:2.0:metadata"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:ServiceName</span> <span class="hljs-attr">xmlns:xml</span>=<span class="hljs-string">"http://www.w3.org/XML/1998/namespace"</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">"sv"</span>&gt;</span>E-myndighetens underskriftstjänst<span class="hljs-tag">&lt;/<span class="hljs-name">md:ServiceName</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">md:ServiceName</span> <span class="hljs-attr">xmlns:xml</span>=<span class="hljs-string">"http://www.w3.org/XML/1998/namespace"</span> <span class="hljs-attr">xml:lang</span>=<span class="hljs-string">"en"</span>&gt;</span>The e-Authority's Signing Service<span class="hljs-tag">&lt;/<span class="hljs-name">md:ServiceName</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">md:RequestedAttribute</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"urn:oid:1.2.752.201.3.11"</span> <span class="hljs-attr">isRequired</span>=<span class="hljs-string">"false"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">md:AttributeConsumingService</span>&gt;</span></code></pre><p><em>Example of how the userSignature attribute is explicitly required.</em></p>
<p><a name="references"></a></p>
<h2 id="7.-references">7. References</h2>
<p><a name="rfc2119"></a>
<strong>[RFC2119]</strong></p>
<blockquote>
<p><a href="http://www.ietf.org/rfc/rfc2119.txt">Bradner, S., Key words for use in RFCs to Indicate Requirement
Levels, March 1997</a>.</p>
</blockquote>
<p><a name="saml2core"></a>
<strong>[SAML2Core]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf">OASIS Standard, Assertions and Protocols for the OASIS Security
Assertion Markup Language (SAML) V2.0, March
2005</a>.</p>
</blockquote>
<p><a name="saml2meta"></a>
<strong>[SAML2Meta]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf">OASIS Standard, Metadata for the OASIS Security Assertion Markup
Language (SAML) V2.0, March
2005</a>.</p>
</blockquote>
<p><a name="saml2metaattr"></a>
<strong>[SAML2MetaAttr]</strong></p>
<blockquote>
<p><a href="http://docs.oasis-open.org/security/saml/Post2.0/sstc-metadata-attr.html">OASIS Committee Specification, SAML V2.0 Metadata Extension for
Entity Attributes Version 1.0, August
2009</a>.</p>
</blockquote>
<p><a name="bankid-spec"></a>
<strong>[BankID_Spec]</strong></p>
<blockquote>
<p><a href="https://www.bankid.com/assets/bankid/rp/bankid-relying-party-guidelines-v3.2.2.pdf">BankID Relying Party Guidelines, version 3.2.2</a>.</p>
<p><em>Check <a href="https://www.bankid.com/rp/info">www.bankid.com/rp/info</a> for lastest version.</em></p>
</blockquote>
<p><a name="eid-profile"></a>
<strong>[EidProfile]</strong></p>
<blockquote>
<p><a href="http://elegnamnden.github.io/technical-framework/latest/ELN-0602_-_Deployment_Profile_for_the_Swedish_eID_Framework.html">Deployment Profile for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eid-attributes"></a>
<strong>[EidAttributes]</strong></p>
<blockquote>
<p><a href="http://elegnamnden.github.io/technical-framework/latest/ELN-0604_-_Attribute_Specification_for_the_Swedish_eID_Framework.html">Attribute Specification for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="eidentcat"></a>
<strong>[EidEntCat]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/updates/ELN-0606_-_Entity_Categories_for_the_Swedish_eID_Framework.html">Entity Categories for the Swedish eID Framework</a>.</p>
</blockquote>
<p><a name="principalsel"></a>
<strong>[PrincipalSel]</strong></p>
<blockquote>
<p><a href="https://docs.swedenconnect.se/technical-framework/updates/ELN-0614_-_Principal_Selection_in_SAML_Authentication_Requests.html">Principal Selection in SAML Authentication Requests</a>.</p>
<p><a name="changes-between-versions"></a></p>
<h2 id="8.-changes-between-versions">8. Changes between versions</h2>
</blockquote>
<p><strong>Changes between version 1.1 and 1.2:</strong></p>
<ul class="list">
<li><p>Section 1.4, &quot;Relying Party Configuration&quot;, was added. The section describes how a Service Provider,
using the <code>secure-authenticator-binding</code> entity category, may request that QR codes are used to initiate BankID operations (which is a more secure process).</p>
</li>
<li><p>Section 3.3 was renamed from &quot;Prompting for Personal Identity Number&quot; to &quot;Mobile BankID on another Device&quot; and its contents was updated to add requirements of the use of QR codes.</p>
</li>
<li><p>Since the BankID API now includes a cancel-method section 3.4, &quot;Cancelling an Operation&quot;, was updated to require usage of this method if the user cancels the operation.</p>
</li>
<li><p>Sections 3.3 and 4.2.2 were updated with new recommendations and requirements for the <code>&lt;psc:PrincipalSelection&gt;</code> extension.</p>
</li>
<li><p>Section 6.2 was updated with a requirement that a BankID Identity Provider should include the <code>&lt;psc:RequestedPrincipalSelection&gt;</code> element in its metadata.</p>
</li>
<li><p>The recommendation in section 3.2 concerning handling of non default browsers was updated.</p>
</li>
<li><p>Section 4.2 was updated with a requirement that ensures that only the intended user sees a sign message.</p>
</li>
</ul>
<p><strong>Changes between version 1.0 and 1.1:</strong></p>
<ul class="list">
<li>Section 3.4, &quot;Cancelling an Operation&quot; was extended with a suggestion of how to avoid dangling sessions after user cancel.</li>
<li>The profile now references the BankID Relying Party Guidelines that makes use of JSON.</li>
</ul>
    </article>
  </body>
</html>
